<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en-gb">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Castle Drawing | Project F: FPGA Dev</title>

<meta property='og:title' content='Castle Drawing - Project F: FPGA Dev'>
<meta property='og:description' content='In this FPGA demo, we use multiple shapes (rectangles, triangles, circles) to render a simple picture of a castle. To learn about hardware drawing, check out my tutorial on Lines and Triangles and 2D Shapes.
Get in touch: GitHub Issues, 1BitSquared Discord, @WillFlux (Mastodon), @WillFlux (Twitter)
Building the Demo
In the Castle Drawing section of the git repo, you&rsquo;ll find the design files, a makefile for Verilator, a Vivado project for Arty, and the build instructions for both.'>
<meta property='og:url' content='https://projectf.io/posts/castle-drawing/'>
<meta property='og:site_name' content='Project F: FPGA Dev'>
<meta property='og:type' content='article'><meta property='og:image' content='https://projectf.io/img/posts/castle-drawing/social-card.png'><meta property='article:published_time' content='2022-09-11T00:00:00Z'><meta property='article:modified_time' content='2022-09-11T00:00:00Z'><meta name='twitter:card' content='summary_large_image'><meta name='twitter:site' content='@WillFlux'><meta name='twitter:creator' content='@WillFlux'>


<link href="https://projectf.io/index.xml" rel="alternate" type="application/rss+xml" title="Project F: FPGA Dev">

<link rel="stylesheet" href="/css/style.css"><link rel='stylesheet' href='https://projectf.io/css/custom.css'>

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<link rel="canonical" href="https://projectf.io/posts/castle-drawing/">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>

<section class="section">
  <div class="container">
    <nav id="nav-main" class="nav">
      <div id="nav-name" class="nav-left">
        <a id="nav-anchor" class="nav-item" href="https://projectf.io">
          <h1 id="nav-heading" class="title is-4">Project F: FPGA Dev</h1>
        </a>
      </div>
      <div class="nav-right">
        <nav id="nav-items" class="nav-item level is-mobile"><a class="level-item" aria-label="github" href='https://github.com/projf/projf-explore'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="twitter" href='https://twitter.com/WillFlux'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="youtube" href='https://youtube.com/channel/UCaT0lvfWo1GStbp0neg8weg'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"/>
    <polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="rss" href='/index.xml'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle>
    
  </svg></i>
            </span>
          </a></nav>
      </div>
    </nav>

    <nav class="nav">
      
      <div class="nav-left"><a class="nav-item" href="/about">
          <h2 class="title is-5">About</h2>
        </a><a class="nav-item" href="/boards">
          <h2 class="title is-5">Boards</h2>
        </a><a class="nav-item" href="/demos">
          <h2 class="title is-5">Demos</h2>
        </a><a class="nav-item" href="/howto">
          <h2 class="title is-5">How To</h2>
        </a><a class="nav-item" href="/tags/news">
          <h2 class="title is-5">News</h2>
        </a><a class="nav-item" href="/tutorials">
          <h2 class="title is-5">Tutorials</h2>
        </a><a class="nav-item" href="/verilog-lib">
          <h2 class="title is-5">Verilog Lib</h2>
        </a></div>
      

      
    </nav>

  </div>
  <script src="/js/navicon-shift.js"></script>
</section>
<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
      
<a class="subtitle is-6" href="/tags/graphics/">#graphics</a>




      
    </div>
    <h2 class="subtitle is-6">11 September 2022</h2>
    <h1 class="title">Castle Drawing</h1>
    
    <div class="content">
      <p>In this FPGA <a href="/demos">demo</a>, we use multiple shapes (rectangles, triangles, circles) to render a simple picture of a castle. To learn about hardware drawing, check out my tutorial on <a href="/posts/lines-and-triangles/">Lines and Triangles</a> and <a href="/posts/fpga-shapes/">2D Shapes</a>.</p>
<p><em>Get in touch: <a href="https://github.com/projf/projf-explore/issues">GitHub Issues</a>, <a href="https://1bitsquared.com/pages/chat">1BitSquared Discord</a>, <a href="https://mastodon.social/@WillFlux">@WillFlux</a> (Mastodon), <a href="https://twitter.com/WillFlux">@WillFlux</a> (Twitter)</em></p>
<p><img src="/img/posts/castle-drawing/castle.png" alt="Castle Verilator Simulation" title="Who would live in a house like this?"></p>
<blockquote>
<p><strong>Building the Demo</strong><br>
In the <a href="https://github.com/projf/projf-explore/tree/main/demos/castle-drawing">Castle Drawing</a> section of the git repo, you&rsquo;ll find the design files, a makefile for Verilator, a Vivado project for Arty, and the build instructions for both.</p>
</blockquote>
<h2 id="demo-structure">Demo Structure</h2>
<ul>
<li>Top module with display interfaces
<ul>
<li>Arty (XC7): <a href="https://github.com/projf/projf-explore/blob/main/graphics/2d-shapes/xc7/top_demo.sv">xc7/top_castle.sv</a></li>
<li>Verilator Sim: <a href="https://github.com/projf/projf-explore/blob/main/graphics/2d-shapes/sim/top_demo.sv">sim/top_castle.sv</a></li>
</ul>
</li>
<li>Castle render module: <a href="https://github.com/projf/projf-explore/blob/main/demos/castle-drawing/render_castle.sv">render_castle.sv</a> (see below)</li>
<li>Drawing routines from Project F library
<ul>
<li><a href="https://github.com/projf/projf-explore/blob/main/lib/graphics/draw_triangle_fill.sv">lib/graphics/draw_triangle_fill.sv</a></li>
<li><a href="https://github.com/projf/projf-explore/blob/main/lib/graphics/draw_rectangle_fill.sv">lib/graphics/draw_rectangle_fill.sv</a></li>
<li><a href="https://github.com/projf/projf-explore/blob/main/lib/graphics/draw_circle_fill.sv">lib/graphics/draw_circle_fill.sv</a></li>
</ul>
</li>
</ul>
<p>As our FPGA graphics capabilities improve, I&rsquo;ll add more features to this drawing. Stay tuned.</p>
<h2 id="rendering-the-castle">Rendering the Castle</h2>
<p>The castle render module is a mix of three shapes drawn with a finite state machine. The background sky and grass are not drawn into the framebuffer but are rendered directly based on the screen position.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#66d9ef">module</span> render_castle #(
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">parameter</span> CORDW<span style="color:#f92672">=</span><span style="color:#ae81ff">16</span>,  <span style="color:#75715e">// signed coordinate width (bits)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">parameter</span> CIDXW<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>,   <span style="color:#75715e">// colour index width (bits)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">parameter</span> SCALE<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>    <span style="color:#75715e">// drawing scale: 1=320x180, 2=640x360, 4=1280x720
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    ) (
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">input</span>  <span style="color:#66d9ef">wire</span> <span style="color:#66d9ef">logic</span> clk,    <span style="color:#75715e">// clock
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">input</span>  <span style="color:#66d9ef">wire</span> <span style="color:#66d9ef">logic</span> rst,    <span style="color:#75715e">// reset
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">input</span>  <span style="color:#66d9ef">wire</span> <span style="color:#66d9ef">logic</span> oe,     <span style="color:#75715e">// output enable
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">input</span>  <span style="color:#66d9ef">wire</span> <span style="color:#66d9ef">logic</span> start,  <span style="color:#75715e">// start drawing
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">output</span>      <span style="color:#66d9ef">logic</span> <span style="color:#66d9ef">signed</span> [CORDW<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] x,  <span style="color:#75715e">// horizontal draw position
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">output</span>      <span style="color:#66d9ef">logic</span> <span style="color:#66d9ef">signed</span> [CORDW<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] y,  <span style="color:#75715e">// vertical draw position
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">output</span>      <span style="color:#66d9ef">logic</span> [CIDXW<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] cidx,  <span style="color:#75715e">// pixel colour
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">output</span>      <span style="color:#66d9ef">logic</span> drawing,  <span style="color:#75715e">// actively drawing
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">output</span>      <span style="color:#66d9ef">logic</span> done      <span style="color:#75715e">// drawing is complete (high for one tick)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">localparam</span> RBOW_CNT<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>;    <span style="color:#75715e">// number of shapes in rainbow
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">localparam</span> SHAPE_CNT<span style="color:#f92672">=</span><span style="color:#ae81ff">19</span>;  <span style="color:#75715e">// number of shapes in castle
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> [$clog2(RBOW_CNT)<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] rbow_id;    <span style="color:#75715e">// rainbow shape identifier
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> [$clog2(SHAPE_CNT)<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] shape_id;  <span style="color:#75715e">// castle shape identifier
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">logic</span> <span style="color:#66d9ef">signed</span> [CORDW<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] vx0, vy0, vx1, vy1, vx2, vy2;  <span style="color:#75715e">// shape coords
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> <span style="color:#66d9ef">signed</span> [CORDW<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] vr0;  <span style="color:#75715e">// circle radius
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> <span style="color:#66d9ef">signed</span> [CORDW<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] x_tri,    y_tri;     <span style="color:#75715e">// triangle framebuffer coords
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> <span style="color:#66d9ef">signed</span> [CORDW<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] x_rect,   y_rect;    <span style="color:#75715e">// rectangle framebuffer coords
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> <span style="color:#66d9ef">signed</span> [CORDW<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] x_circle, y_circle;  <span style="color:#75715e">// circle framebuffer coords
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> draw_done;  <span style="color:#75715e">// combined done signal
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> draw_start_tri, drawing_tri, draw_done_tri;           <span style="color:#75715e">// drawing triangle
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> draw_start_rect, drawing_rect, draw_done_rect;        <span style="color:#75715e">// drawing rectangle
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> draw_start_circle, drawing_circle, draw_done_circle;  <span style="color:#75715e">// drawing circle
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// draw state machine
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">enum</span> {IDLE, INIT_RBOW, DRAW_RBOW, INIT_CASTLE, DRAW_CASTLE, DONE} state;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">always_ff</span> @(<span style="color:#66d9ef">posedge</span> clk) <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> (state)
</span></span><span style="display:flex;"><span>            INIT_RBOW: <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>                state <span style="color:#f92672">&lt;=</span> DRAW_RBOW;
</span></span><span style="display:flex;"><span>                draw_start_circle <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                vx0 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">368</span>;
</span></span><span style="display:flex;"><span>                vy0 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">160</span>;
</span></span><span style="display:flex;"><span>                vr0 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">180</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">*</span> rbow_id;
</span></span><span style="display:flex;"><span>                cidx <span style="color:#f92672">&lt;=</span> (rbow_id <span style="color:#f92672">==</span> RBOW_CNT<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">?</span> <span style="color:#ae81ff">&#39;h0</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">&#39;h2</span> <span style="color:#f92672">+</span> rbow_id;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>            DRAW_RBOW: <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>                draw_start_circle <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (draw_done) <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (rbow_id <span style="color:#f92672">==</span> RBOW_CNT<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>                        state <span style="color:#f92672">&lt;=</span> INIT_CASTLE;
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>                        rbow_id <span style="color:#f92672">&lt;=</span> rbow_id <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                        state <span style="color:#f92672">&lt;=</span> INIT_RBOW;
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>            INIT_CASTLE: <span style="color:#66d9ef">begin</span>  <span style="color:#75715e">// register coordinates and colour (Sweetie 16 palette)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                state <span style="color:#f92672">&lt;=</span> DRAW_CASTLE;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">case</span> (shape_id)
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">&#39;d0</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">begin</span>  <span style="color:#75715e">// main building
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        draw_start_rect <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                        vx0 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">60</span>; vy0 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">75</span>;
</span></span><span style="display:flex;"><span>                        vx1 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">190</span>; vy1 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">130</span>;
</span></span><span style="display:flex;"><span>                        cidx <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">&#39;hE</span>;  <span style="color:#75715e">// dark grey
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">&#39;d1</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">begin</span>  <span style="color:#75715e">// drawbridge
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        draw_start_rect <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                        vx0 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">110</span>; vy0 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">110</span>;
</span></span><span style="display:flex;"><span>                        vx1 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">140</span>; vy1 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">130</span>;
</span></span><span style="display:flex;"><span>                        cidx <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">&#39;hF</span>;  <span style="color:#75715e">// blue-grey
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">&#39;d2</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">begin</span>  <span style="color:#75715e">// drawbridge arch
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        draw_start_circle <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                        vx0 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">125</span>; vy0 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">110</span>;
</span></span><span style="display:flex;"><span>                        vr0 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">15</span>;
</span></span><span style="display:flex;"><span>                        cidx <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">&#39;hF</span>;  <span style="color:#75715e">// blue-grey
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">&#39;d3</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">begin</span>  <span style="color:#75715e">// left tower
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        draw_start_rect <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                        vx0 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">40</span>; vy0 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">50</span>;
</span></span><span style="display:flex;"><span>                        vx1 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">60</span>; vy1 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">130</span>;
</span></span><span style="display:flex;"><span>                        cidx <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">&#39;hE</span>;  <span style="color:#75715e">// dark grey
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">&#39;d4</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">begin</span>  <span style="color:#75715e">// middle tower
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        draw_start_rect <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                        vx0 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">110</span>; vy0 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">45</span>;
</span></span><span style="display:flex;"><span>                        vx1 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">140</span>; vy1 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">75</span>;
</span></span><span style="display:flex;"><span>                        cidx <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">&#39;hE</span>;  <span style="color:#75715e">// dark grey
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">&#39;d5</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">begin</span>  <span style="color:#75715e">// right tower
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        draw_start_rect <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                        vx0 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">190</span>; vy0 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">50</span>;
</span></span><span style="display:flex;"><span>                        vx1 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">210</span>; vy1 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">130</span>;
</span></span><span style="display:flex;"><span>                        cidx <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">&#39;hE</span>;  <span style="color:#75715e">// dark grey
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">&#39;d6</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">begin</span>  <span style="color:#75715e">// left roof
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        draw_start_tri <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                        vx0 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">50</span>; vy0 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">35</span>;
</span></span><span style="display:flex;"><span>                        vx1 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">65</span>; vy1 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">50</span>;
</span></span><span style="display:flex;"><span>                        vx2 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">35</span>; vy2 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">50</span>;
</span></span><span style="display:flex;"><span>                        cidx <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">&#39;h2</span>;  <span style="color:#75715e">// red
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">&#39;d7</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">begin</span>  <span style="color:#75715e">// middle roof
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        draw_start_tri <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                        vx0 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">125</span>; vy0 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">25</span>;
</span></span><span style="display:flex;"><span>                        vx1 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">145</span>; vy1 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">45</span>;
</span></span><span style="display:flex;"><span>                        vx2 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">105</span>; vy2 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">45</span>;
</span></span><span style="display:flex;"><span>                        cidx <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">&#39;h2</span>;  <span style="color:#75715e">// red
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">&#39;d8</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">begin</span>  <span style="color:#75715e">// right roof
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        draw_start_tri <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                        vx0 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">200</span>; vy0 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">35</span>;
</span></span><span style="display:flex;"><span>                        vx1 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">215</span>; vy1 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">50</span>;
</span></span><span style="display:flex;"><span>                        vx2 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">185</span>; vy2 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">50</span>;
</span></span><span style="display:flex;"><span>                        cidx <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">&#39;h2</span>;  <span style="color:#75715e">// red
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">&#39;d9</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">begin</span>  <span style="color:#75715e">// left window
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        draw_start_rect <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                        vx0 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">46</span>; vy0 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">55</span>;
</span></span><span style="display:flex;"><span>                        vx1 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">54</span>; vy1 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">70</span>;
</span></span><span style="display:flex;"><span>                        cidx <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">&#39;hF</span>;  <span style="color:#75715e">// blue-grey
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">&#39;d10</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">begin</span>  <span style="color:#75715e">// middle window
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        draw_start_rect <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                        vx0 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">120</span>; vy0 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">50</span>;
</span></span><span style="display:flex;"><span>                        vx1 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">130</span>; vy1 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">70</span>;
</span></span><span style="display:flex;"><span>                        cidx <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">&#39;hF</span>;  <span style="color:#75715e">// blue-grey
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">&#39;d11</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">begin</span>  <span style="color:#75715e">// right window
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        draw_start_rect <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                        vx0 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">196</span>; vy0 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">55</span>;
</span></span><span style="display:flex;"><span>                        vx1 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">204</span>; vy1 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">70</span>;
</span></span><span style="display:flex;"><span>                        cidx <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">&#39;hF</span>;  <span style="color:#75715e">// blue-grey
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">&#39;d12</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">begin</span>  <span style="color:#75715e">// battlement 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        draw_start_rect <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                        vx0 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">63</span>; vy0 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">67</span>;
</span></span><span style="display:flex;"><span>                        vx1 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">72</span>; vy1 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">75</span>;
</span></span><span style="display:flex;"><span>                        cidx <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">&#39;hE</span>;  <span style="color:#75715e">// dark grey
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">&#39;d13</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">begin</span>  <span style="color:#75715e">// battlement 2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        draw_start_rect <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                        vx0 <span style="color:#f92672">&lt;=</span>   <span style="color:#ae81ff">80</span>; vy0 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">67</span>;
</span></span><span style="display:flex;"><span>                        vx1 <span style="color:#f92672">&lt;=</span>   <span style="color:#ae81ff">89</span>; vy1 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">75</span>;
</span></span><span style="display:flex;"><span>                        cidx <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">&#39;hE</span>;  <span style="color:#75715e">// dark grey
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">&#39;d14</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">begin</span>  <span style="color:#75715e">// battlement 3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        draw_start_rect <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                        vx0 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">97</span>; vy0 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">67</span>;
</span></span><span style="display:flex;"><span>                        vx1 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">106</span>; vy1 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">75</span>;
</span></span><span style="display:flex;"><span>                        cidx <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">&#39;hE</span>;  <span style="color:#75715e">// dark grey
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">&#39;d15</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">begin</span>  <span style="color:#75715e">// battlement 4
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        draw_start_rect <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                        vx0 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">144</span>; vy0 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">67</span>;
</span></span><span style="display:flex;"><span>                        vx1 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">153</span>; vy1 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">75</span>;
</span></span><span style="display:flex;"><span>                        cidx <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">&#39;hE</span>;  <span style="color:#75715e">// dark grey
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">&#39;d16</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">begin</span>  <span style="color:#75715e">// battlement 5
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        draw_start_rect <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                        vx0 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">161</span>; vy0 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">67</span>;
</span></span><span style="display:flex;"><span>                        vx1 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">170</span>; vy1 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">75</span>;
</span></span><span style="display:flex;"><span>                        cidx <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">&#39;hE</span>;  <span style="color:#75715e">// dark grey
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">&#39;d17</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">begin</span>  <span style="color:#75715e">// battlement 6
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        draw_start_rect <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                        vx0 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">178</span>; vy0 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">67</span>;
</span></span><span style="display:flex;"><span>                        vx1 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">187</span>; vy1 <span style="color:#f92672">&lt;=</span>  <span style="color:#ae81ff">75</span>;
</span></span><span style="display:flex;"><span>                        cidx <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">&#39;hE</span>;  <span style="color:#75715e">// dark grey
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">begin</span>  <span style="color:#75715e">// clear ground
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        draw_start_rect <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                        vx0 <span style="color:#f92672">&lt;=</span>   <span style="color:#ae81ff">0</span>; vy0 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">131</span>;
</span></span><span style="display:flex;"><span>                        vx1 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">319</span>; vy1 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">179</span>;
</span></span><span style="display:flex;"><span>                        cidx <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">&#39;h0</span>;  <span style="color:#75715e">// background (transparent)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">endcase</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>            DRAW_CASTLE: <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>                draw_start_tri    <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>                draw_start_rect   <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>                draw_start_circle <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (draw_done) <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (shape_id <span style="color:#f92672">==</span> SHAPE_CNT<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>                        state <span style="color:#f92672">&lt;=</span> DONE;
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>                        shape_id <span style="color:#f92672">&lt;=</span> shape_id <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                        state <span style="color:#f92672">&lt;=</span> INIT_CASTLE;
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>            DONE: state <span style="color:#f92672">&lt;=</span> DONE;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">if</span> (start) state <span style="color:#f92672">&lt;=</span> INIT_RBOW;  <span style="color:#75715e">// IDLE
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">endcase</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (rst) state <span style="color:#f92672">&lt;=</span> IDLE;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    draw_triangle_fill #(.CORDW(CORDW)) draw_triangle_inst (
</span></span><span style="display:flex;"><span>        .clk,
</span></span><span style="display:flex;"><span>        .rst,
</span></span><span style="display:flex;"><span>        .start(draw_start_tri),
</span></span><span style="display:flex;"><span>        .oe,
</span></span><span style="display:flex;"><span>        .x0(vx0 <span style="color:#f92672">*</span> SCALE),
</span></span><span style="display:flex;"><span>        .y0(vy0 <span style="color:#f92672">*</span> SCALE),
</span></span><span style="display:flex;"><span>        .x1(vx1 <span style="color:#f92672">*</span> SCALE),
</span></span><span style="display:flex;"><span>        .y1(vy1 <span style="color:#f92672">*</span> SCALE),
</span></span><span style="display:flex;"><span>        .x2(vx2 <span style="color:#f92672">*</span> SCALE),
</span></span><span style="display:flex;"><span>        .y2(vy2 <span style="color:#f92672">*</span> SCALE),
</span></span><span style="display:flex;"><span>        .x(x_tri),
</span></span><span style="display:flex;"><span>        .y(y_tri),
</span></span><span style="display:flex;"><span>        .drawing(drawing_tri),
</span></span><span style="display:flex;"><span>        .busy(),
</span></span><span style="display:flex;"><span>        .done(draw_done_tri)
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    draw_rectangle_fill #(.CORDW(CORDW)) draw_rectangle_inst (
</span></span><span style="display:flex;"><span>        .clk,
</span></span><span style="display:flex;"><span>        .rst,
</span></span><span style="display:flex;"><span>        .start(draw_start_rect),
</span></span><span style="display:flex;"><span>        .oe,
</span></span><span style="display:flex;"><span>        .x0(vx0 <span style="color:#f92672">*</span> SCALE),
</span></span><span style="display:flex;"><span>        .y0(vy0 <span style="color:#f92672">*</span> SCALE),
</span></span><span style="display:flex;"><span>        .x1(vx1 <span style="color:#f92672">*</span> SCALE),
</span></span><span style="display:flex;"><span>        .y1(vy1 <span style="color:#f92672">*</span> SCALE),
</span></span><span style="display:flex;"><span>        .x(x_rect),
</span></span><span style="display:flex;"><span>        .y(y_rect),
</span></span><span style="display:flex;"><span>        .drawing(drawing_rect),
</span></span><span style="display:flex;"><span>        .busy(),
</span></span><span style="display:flex;"><span>        .done(draw_done_rect)
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    draw_circle_fill #(.CORDW(CORDW)) draw_circle_inst (
</span></span><span style="display:flex;"><span>        .clk,
</span></span><span style="display:flex;"><span>        .rst,
</span></span><span style="display:flex;"><span>        .start(draw_start_circle),
</span></span><span style="display:flex;"><span>        .oe,
</span></span><span style="display:flex;"><span>        .x0(vx0 <span style="color:#f92672">*</span> SCALE),
</span></span><span style="display:flex;"><span>        .y0(vy0 <span style="color:#f92672">*</span> SCALE),
</span></span><span style="display:flex;"><span>        .r0(vr0 <span style="color:#f92672">*</span> SCALE),
</span></span><span style="display:flex;"><span>        .x(x_circle),
</span></span><span style="display:flex;"><span>        .y(y_circle),
</span></span><span style="display:flex;"><span>        .drawing(drawing_circle),
</span></span><span style="display:flex;"><span>        .busy(),
</span></span><span style="display:flex;"><span>        .done(draw_done_circle)
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// output coordinates for the active shape
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">always_ff</span> @(<span style="color:#66d9ef">posedge</span> clk) <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">&lt;=</span> drawing_tri <span style="color:#f92672">?</span> x_tri <span style="color:#f92672">:</span> (drawing_rect <span style="color:#f92672">?</span> x_rect <span style="color:#f92672">:</span> x_circle);
</span></span><span style="display:flex;"><span>        y <span style="color:#f92672">&lt;=</span> drawing_tri <span style="color:#f92672">?</span> y_tri <span style="color:#f92672">:</span> (drawing_rect <span style="color:#f92672">?</span> y_rect <span style="color:#f92672">:</span> y_circle);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// drawing and done apply to all drawing types
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">always_ff</span> @(<span style="color:#66d9ef">posedge</span> clk) <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>        drawing   <span style="color:#f92672">&lt;=</span> drawing_tri   <span style="color:#f92672">||</span> drawing_rect   <span style="color:#f92672">||</span> drawing_circle;
</span></span><span style="display:flex;"><span>        draw_done <span style="color:#f92672">&lt;=</span> draw_done_tri <span style="color:#f92672">||</span> draw_done_rect <span style="color:#f92672">||</span> draw_done_circle;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// doesn&#39;t need delaying one cycle because it&#39;s based on draw_done
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">always_ff</span> @(<span style="color:#66d9ef">posedge</span> clk) done <span style="color:#f92672">&lt;=</span> (state <span style="color:#f92672">==</span> DONE);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">endmodule</span>
</span></span></code></pre></div><blockquote>
<p><strong>Sponsor My Work</strong><br>
If you like what I do, consider <a href="https://github.com/sponsors/WillGreen">sponsoring me</a> on GitHub.<br>
I love FPGAs and want to help more people discover and use them in their projects.<br>
My hardware designs are open source, and my blog is advert free.</p>
</blockquote>
<h2 id="whats-next">What&rsquo;s Next?</h2>
<p>Check out other <a href="/demos">demos</a> and the <a href="/posts/fpga-graphics/">FPGA graphics tutorial series</a>.</p>
<p><em>Get in touch: <a href="https://github.com/projf/projf-explore/issues">GitHub Issues</a>, <a href="https://1bitsquared.com/pages/chat">1BitSquared Discord</a>, <a href="https://mastodon.social/@WillFlux">@WillFlux</a> (Mastodon), <a href="https://twitter.com/WillFlux">@WillFlux</a> (Twitter)</em></p>

      
    </div>
    
  </div>
</section>

    <script src="/js/copycode.js"></script>



<section class="section">
  <div class="container has-text-centered">
    <p>©2022 Will Green, Project F</p>
    
  </div>
</section>


<script src="https://badgers.projectf.io/script.js" data-site="EVCGKVDN" defer></script>



</body>
</html>

