<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en-gb">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Initialize Memory in Verilog | Project F: FPGA Dev</title>

<meta property='og:title' content='Initialize Memory in Verilog - Project F: FPGA Dev'>
<meta property='og:description' content='It&rsquo;s common for a simulation or firmware to need data loading into a memory array, ram, or rom. Fortunately, Verilog provides the $readmemh and $readmemb functions for this very purpose. Unfortunately, there is a dearth of good Verilog documentation online, so using them can be harder than it should be. This how to explains the syntax and provides plenty of examples, including how to do this in Yosys and Xilinx Vivado.'>
<meta property='og:url' content='https://projectf.io/posts/initialize-memory-in-verilog/'>
<meta property='og:site_name' content='Project F: FPGA Dev'>
<meta property='og:type' content='article'><meta property='og:image' content='https://projectf.io/img/posts/initialize-memory-in-verilog/social-card.jpg'><meta property='article:published_time' content='2020-04-16T00:00:00Z'><meta property='article:modified_time' content='2021-07-20T00:00:00Z'><meta name='twitter:card' content='summary_large_image'><meta name='twitter:site' content='@WillFlux'><meta name='twitter:creator' content='@WillFlux'>


<link href="https://projectf.io/index.xml" rel="alternate" type="application/rss+xml" title="Project F: FPGA Dev">

<link rel="stylesheet" href="/css/style.css"><link rel='stylesheet' href='https://projectf.io/css/custom.css'>

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<link rel="canonical" href="https://projectf.io/posts/initialize-memory-in-verilog/">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>

<section class="section">
  <div class="container">
    <nav id="nav-main" class="nav">
      <div id="nav-name" class="nav-left">
        <a id="nav-anchor" class="nav-item" href="https://projectf.io">
          <h1 id="nav-heading" class="title is-4">Project F: FPGA Dev</h1>
        </a>
      </div>
      <div class="nav-right">
        <nav id="nav-items" class="nav-item level is-mobile"><a class="level-item" aria-label="github" href='https://github.com/projf/projf-explore'
            target='_blank' rel='me noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg>
</i>
            </span>
          </a><a class="level-item" aria-label="mastodon" href='https://mastodon.social/@WillFlux'
            target='_blank' rel='me noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M 11.966876,0.80329086 C 9.1123466,0.82665791 6.3664935,1.1367094 4.7662978,1.8737549 c 0,0 -3.1736685,1.4237835 -3.1736685,6.2815982 0,1.1123884 -0.021554,2.4424309 0.013571,3.8529439 0.1152443,4.750677 0.8683725,9.432704 5.2479219,10.595273 2.0193066,0.53604 3.7531218,0.648348 5.1494078,0.571373 2.532141,-0.140797 3.953603,-0.906282 3.953603,-0.906282 l -0.08353,-1.842608 c 0,0 -1.809527,0.572181 -3.841713,0.50245 -2.013417,-0.06922 -4.138986,-0.217713 -4.4646269,-2.696937 -0.030082,-0.217772 -0.045075,-0.450712 -0.045075,-0.695267 0,0 1.9765387,0.484554 4.4813709,0.599656 1.531629,0.07049 2.9679,-0.08996 4.426746,-0.264563 2.797636,-0.335045 5.233581,-2.063856 5.539741,-3.643517 0.482392,-2.488386 0.442651,-6.0725219 0.442651,-6.0725219 0,-4.8578147 -3.173492,-6.2815982 -3.173492,-6.2815982 C 17.639136,1.1367094 14.891579,0.82669685 12.03704,0.80329086 Z"/>
  <path d="M 6.4286668,14.016701 V 9.1034254 c 0,-1.0041614 0.2549569,-1.8022059 0.7670342,-2.3925638 0.5280486,-0.590366 1.2196579,-0.8929946 2.0781049,-0.8929946 0.9931961,0 1.7452181,0.3828583 2.2425191,1.1486808 L 11.999859,7.7793695 12,11.451148 11.999859,7.7793695 12.483392,6.9665478 C 12.980596,6.2007253 13.732618,5.817867 14.72592,5.817867 c 0.858341,0 1.549951,0.3026286 2.078097,0.8929946 0.511971,0.5903579 0.766887,1.3884024 0.766887,2.3925638 v 4.9132756" />
    
  </svg>
</i>
            </span>
          </a><a class="level-item" aria-label="youtube" href='https://youtube.com/@projf'
            target='_blank' rel='me noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"/>
    <polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"/>
    
  </svg>
</i>
            </span>
          </a><a class="level-item" aria-label="rss" href='/index.xml'
            target='_blank' rel='me noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle>
    
  </svg>
</i>
            </span>
          </a></nav>
      </div>
    </nav>

    <nav class="nav">
      
      <div class="nav-left"><a class="nav-item" href="/about">
          <h2 class="title is-5">About</h2>
        </a><a class="nav-item" href="/demos">
          <h2 class="title is-5">Demos</h2>
        </a><a class="nav-item" href="/howto">
          <h2 class="title is-5">How To</h2>
        </a><a class="nav-item" href="/tags/news">
          <h2 class="title is-5">News</h2>
        </a><a class="nav-item" href="/tutorials">
          <h2 class="title is-5">Tutorials</h2>
        </a><a class="nav-item" href="/verilog-lib">
          <h2 class="title is-5">Verilog Lib</h2>
        </a></div>
      

      
    </nav>

  </div>
  <script src="/js/navicon-shift.js"></script>
</section>

<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
      
<a class="subtitle is-6" href="/tags/memory/">#memory</a>




      
    </div>
    <h2 class="subtitle is-6">16 April 2020</h2>
    <h1 class="title">Initialize Memory in Verilog</h1>
    
    <div class="content">
      <p>It&rsquo;s common for a simulation or firmware to need data loading into a memory array, ram, or rom. Fortunately, Verilog provides the <strong><code>$readmemh</code></strong> and <strong><code>$readmemb</code></strong> functions for this very purpose. Unfortunately, there is a dearth of good Verilog documentation online, so using them can be harder than it should be. This <a href="/howto">how to</a> explains the syntax and provides plenty of examples, including how to do this in Yosys and Xilinx Vivado. This post was last updated in July 2021.</p>
<p>If you want to learn more about FPGA memory itself, see <a href="/posts/fpga-memory-types/">FPGA Memory Types</a>.</p>
<p><em>Get in touch: <a href="https://mastodon.social/@WillFlux">@WillFlux</a> (Mastodon), <a href="https://github.com/WillGreen">@WillGreen</a> (GitHub), or find me on <a href="https://discord.gg/cf869yDbXf">1BitSquared Discord</a>.</em></p>
<blockquote>
<p><strong>Sponsor My Work</strong><br>
If you like what I do, consider <a href="https://github.com/sponsors/WillGreen">sponsoring me</a> on GitHub.<br>
I love FPGAs and want to help more people discover and use them in their projects.<br>
My hardware designs are open source, and my blog is advert free.</p>
</blockquote>
<h2 id="verilog-syntax">Verilog Syntax</h2>
<p>Verilog allows you to initialize memory from a text file with either hex or binary values:</p>
<ul>
<li><strong><code>$readmemh(&quot;hex_memory_file.mem&quot;, memory_array, [start_address], [end_address])</code></strong></li>
<li><strong><code>$readmemb(&quot;bin_memory_file.mem&quot;, memory_array, [start_address], [end_address])</code></strong></li>
</ul>
<h3 id="function-arguments">Function Arguments</h3>
<ul>
<li><code>hex_memory_file.mem</code> - a text file containing hex values separated by whitespace</li>
<li><code>bin_memory_file.mem</code> - a text file containing binary values separated by whitespace</li>
<li><code>memory_array</code> - name of Verilog memory array of the form: <code>reg [n:0] memory_array [0:m]</code></li>
<li><code>start_address</code> - where in the memory array to start loading data (optional)</li>
<li><code>end_address</code> - where in the memory array to stop loading data (optional)</li>
</ul>
<p>The following shows a very simple simulation module using <code>$readmemh</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#66d9ef">module</span> readmemh_tb();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">reg</span> [<span style="color:#ae81ff">7</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] test_memory [<span style="color:#ae81ff">0</span><span style="color:#f92672">:</span><span style="color:#ae81ff">15</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">initial</span> <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>        $display(<span style="color:#e6db74">&#34;Loading rom.&#34;</span>);
</span></span><span style="display:flex;"><span>        $readmemh(<span style="color:#e6db74">&#34;rom_image.mem&#34;</span>, test_memory);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">endmodule</span>
</span></span></code></pre></div><p>The test memory has 16 locations <code>[0:15]</code> (depth) each of 8 bits <code>[7:0]</code> (data width).</p>
<h3 id="memory-file-syntax">Memory File Syntax</h3>
<p>The <code>hex_memory_file.mem</code> or <code>bin_memory_file.mem</code> file consists of text hex/binary values separated by whitespace: space, tab, and newline all work. You can mix the whitespace types in one file. Comments are the same as regular Verilog files: <strong><code>//</code></strong>  begins a comment.</p>
<p>The width of a data value in the file mustn&rsquo;t be wider than the data width of the array; otherwise, that value will be truncated. In Vivado, you&rsquo;ll see a warning in the log <em>WARNING: Data truncated while reading Datafile</em>.</p>
<h2 id="verilog-examples">Verilog Examples</h2>
<p>The following examples show <code>$readmemh</code> and <code>$readmemb</code> with a range of different initialization files. Some older tools are really picky; if you have issues, you may need to avoid comments and mixing whitespace.</p>
<h3 id="1-four-16-bit-data-values-in-hex">1) Four 16-bit data values in hex</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#66d9ef">reg</span> [<span style="color:#ae81ff">15</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] ex1_memory [<span style="color:#ae81ff">0</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span>$readmemh(<span style="color:#e6db74">&#34;ex1.mem&#34;</span>, ex1_memory);
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plaintext" data-lang="plaintext"><span style="display:flex;"><span>dead
</span></span><span style="display:flex;"><span>beef
</span></span><span style="display:flex;"><span>0a0a
</span></span><span style="display:flex;"><span>1234
</span></span></code></pre></div><h3 id="2-sixteen-8-bit-data-values-in-hex-mixing-spaces-and-newlines">2) Sixteen 8-bit data values in hex (mixing spaces and newlines)</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#66d9ef">reg</span> [<span style="color:#ae81ff">7</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] ex2_memory [<span style="color:#ae81ff">0</span><span style="color:#f92672">:</span><span style="color:#ae81ff">15</span>];
</span></span><span style="display:flex;"><span>$readmemh(<span style="color:#e6db74">&#34;ex2.mem&#34;</span>, ex2_memory);
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plaintext" data-lang="plaintext"><span style="display:flex;"><span>ab cd ef 01  // this is a comment
</span></span><span style="display:flex;"><span>ef 22 1e 00
</span></span><span style="display:flex;"><span>9f ff 13 e6
</span></span><span style="display:flex;"><span>ce b7 28 8f
</span></span></code></pre></div><h3 id="3-six-3-bit-values-in-binary">3) Six 3-bit values in binary</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#66d9ef">reg</span> [<span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] ex3_memory [<span style="color:#ae81ff">0</span><span style="color:#f92672">:</span><span style="color:#ae81ff">5</span>];
</span></span><span style="display:flex;"><span>$readmemb(<span style="color:#e6db74">&#34;ex3.mem&#34;</span>, ex3_memory);
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plaintext" data-lang="plaintext"><span style="display:flex;"><span>001 101 111 111 101 001
</span></span></code></pre></div><h3 id="4-six-16-bit-values-in-hex-starting-at-array-position-4">4) Six 16-bit values in hex starting at array position 4</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#66d9ef">reg</span> [<span style="color:#ae81ff">15</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] ex4_memory [<span style="color:#ae81ff">0</span><span style="color:#f92672">:</span><span style="color:#ae81ff">255</span>];
</span></span><span style="display:flex;"><span>$readmemh(<span style="color:#e6db74">&#34;ex4.mem&#34;</span>, ex4_memory, <span style="color:#ae81ff">4</span>);
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plaintext" data-lang="plaintext"><span style="display:flex;"><span>dead beef 0a0a 1234 abab 987e
</span></span></code></pre></div><p><em>NB. As demonstrated by this example, the memory array can have more entries than the data file.</em></p>
<h2 id="yosys">Yosys</h2>
<p>Yosys automatically picks up <code>$readmemh</code> and <code>$readmemb</code> files, but you need to include the path if the memory file isn&rsquo;t in the same directory as the Verilog module. You can see examples of this in the iCEBreaker designs for <a href="/posts/hardware-sprites/">Hardware Sprites</a>.</p>
<h2 id="vivado">Vivado</h2>
<p>The easy way to get memory files working with Vivado is to give them the <strong><code>.mem</code></strong> extension then add them to your project. You do this as you would for a design or simulation source using &ldquo;Add Sources&rdquo; then selecting &ldquo;Files of type: Memory Initialization Files&rdquo;. Vivado will automatically identify them as memory files and place them in the current working directory during simulation etc.</p>
<p>If you reference a file but don&rsquo;t add it to the project, you&rsquo;ll get an error of the form:</p>
<p><em>WARNING: File rom_image.mem referenced on acme.v at line 42 cannot be opened for reading. Please ensure that this file is available in the current working directory.</em></p>
<p>Once you&rsquo;ve added the files to your project, they will show up in the Sources view under Design or Simulation Sources.</p>
<p><em>PS. The wonderful image of the Micron MT4C1024 DRAM used in the social media card for this post comes from <a href="https://zeptobars.com/en/read/Micron-MT4C1024-dram">Zeptobars</a> and is licensed under a <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons licence</a>.</em></p>
<p><em>Get in touch: <a href="https://mastodon.social/@WillFlux">@WillFlux</a> (Mastodon), <a href="https://github.com/WillGreen">@WillGreen</a> (GitHub), or find me on <a href="https://discord.gg/cf869yDbXf">1BitSquared Discord</a>.</em></p>

      
    </div>
    
  </div>
</section>

    <script src="/js/copycode.js"></script>



<section class="section">
  <div class="container has-text-centered">
    <p>©2023 Will Green, Project F</p>
    
  </div>
</section>


<script src="https://badgers.projectf.io/script.js" data-site="EVCGKVDN" defer></script>



</body>
</html>

