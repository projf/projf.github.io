<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en-gb">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>SPRAM on iCE40 FPGA | Project F: FPGA Dev</title>

<meta property='og:title' content='SPRAM on iCE40 FPGA - Project F: FPGA Dev'>
<meta property='og:description' content='The iCE40 UltraPlus distinguishes itself from the rest of the iCE40 FPGA family by including a relatively generous 1 Mb (128 KiB) of single port synchronous SRAM known as SPRAM. SPRAM blocks are much larger than BRAM but are limited to a single port and 16-bit data bus.
In this quick how to, we learn how to use SPRAM with Yosys and contrast it with Block RAM. If you want to learn more about other FPGA memory, see FPGA Memory Types.'>
<meta property='og:url' content='https://projectf.io/posts/spram-ice40-fpga/'>
<meta property='og:site_name' content='Project F: FPGA Dev'>
<meta property='og:type' content='article'><meta property='og:image' content='https://projectf.io/img/posts/spram-ice40-fpga/social-card.jpg'><meta property='article:published_time' content='2021-07-30T00:00:00Z'><meta property='article:modified_time' content='2021-09-20T00:00:00Z'><meta name='twitter:card' content='summary_large_image'><meta name='twitter:site' content='@WillFlux'><meta name='twitter:creator' content='@WillFlux'>


<link href="https://projectf.io/index.xml" rel="alternate" type="application/rss+xml" title="Project F: FPGA Dev">

<link rel="stylesheet" href="/css/style.css"><link rel='stylesheet' href='https://projectf.io/css/custom.css'>

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<link rel="canonical" href="https://projectf.io/posts/spram-ice40-fpga/">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>

<section class="section">
  <div class="container">
    <nav id="nav-main" class="nav">
      <div id="nav-name" class="nav-left">
        <a id="nav-anchor" class="nav-item" href="https://projectf.io">
          <h1 id="nav-heading" class="title is-4">Project F: FPGA Dev</h1>
        </a>
      </div>
      <div class="nav-right">
        <nav id="nav-items" class="nav-item level is-mobile"><a class="level-item" aria-label="github" href='https://github.com/projf/projf-explore'
            target='_blank' rel='me noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg>
</i>
            </span>
          </a><a class="level-item" aria-label="mastodon" href='https://mastodon.social/@WillFlux'
            target='_blank' rel='me noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M 11.966876,0.80329086 C 9.1123466,0.82665791 6.3664935,1.1367094 4.7662978,1.8737549 c 0,0 -3.1736685,1.4237835 -3.1736685,6.2815982 0,1.1123884 -0.021554,2.4424309 0.013571,3.8529439 0.1152443,4.750677 0.8683725,9.432704 5.2479219,10.595273 2.0193066,0.53604 3.7531218,0.648348 5.1494078,0.571373 2.532141,-0.140797 3.953603,-0.906282 3.953603,-0.906282 l -0.08353,-1.842608 c 0,0 -1.809527,0.572181 -3.841713,0.50245 -2.013417,-0.06922 -4.138986,-0.217713 -4.4646269,-2.696937 -0.030082,-0.217772 -0.045075,-0.450712 -0.045075,-0.695267 0,0 1.9765387,0.484554 4.4813709,0.599656 1.531629,0.07049 2.9679,-0.08996 4.426746,-0.264563 2.797636,-0.335045 5.233581,-2.063856 5.539741,-3.643517 0.482392,-2.488386 0.442651,-6.0725219 0.442651,-6.0725219 0,-4.8578147 -3.173492,-6.2815982 -3.173492,-6.2815982 C 17.639136,1.1367094 14.891579,0.82669685 12.03704,0.80329086 Z"/>
  <path d="M 6.4286668,14.016701 V 9.1034254 c 0,-1.0041614 0.2549569,-1.8022059 0.7670342,-2.3925638 0.5280486,-0.590366 1.2196579,-0.8929946 2.0781049,-0.8929946 0.9931961,0 1.7452181,0.3828583 2.2425191,1.1486808 L 11.999859,7.7793695 12,11.451148 11.999859,7.7793695 12.483392,6.9665478 C 12.980596,6.2007253 13.732618,5.817867 14.72592,5.817867 c 0.858341,0 1.549951,0.3026286 2.078097,0.8929946 0.511971,0.5903579 0.766887,1.3884024 0.766887,2.3925638 v 4.9132756" />
    
  </svg>
</i>
            </span>
          </a><a class="level-item" aria-label="youtube" href='https://youtube.com/@projf'
            target='_blank' rel='me noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"/>
    <polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"/>
    
  </svg>
</i>
            </span>
          </a><a class="level-item" aria-label="rss" href='/index.xml'
            target='_blank' rel='me noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle>
    
  </svg>
</i>
            </span>
          </a></nav>
      </div>
    </nav>

    <nav class="nav">
      
      <div class="nav-left"><a class="nav-item" href="/about">
          <h2 class="title is-5">About</h2>
        </a><a class="nav-item" href="/demos">
          <h2 class="title is-5">Demos</h2>
        </a><a class="nav-item" href="/howto">
          <h2 class="title is-5">How To</h2>
        </a><a class="nav-item" href="/tags/news">
          <h2 class="title is-5">News</h2>
        </a><a class="nav-item" href="/tutorials">
          <h2 class="title is-5">Tutorials</h2>
        </a><a class="nav-item" href="/verilog-lib">
          <h2 class="title is-5">Verilog Lib</h2>
        </a></div>
      

      
    </nav>

  </div>
  <script src="/js/navicon-shift.js"></script>
</section>

<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
      
<a class="subtitle is-6" href="/tags/ice40/">#ice40</a>



  
  | <a class="subtitle is-6" href="/tags/memory/">#memory</a>
  


      
    </div>
    <h2 class="subtitle is-6">30 July 2021</h2>
    <h1 class="title">SPRAM on iCE40 FPGA</h1>
    
    <div class="content">
      <p>The iCE40 UltraPlus distinguishes itself from the rest of the iCE40 FPGA family by including a relatively generous 1 Mb (128 KiB) of single port synchronous SRAM known as <strong>SPRAM</strong>. SPRAM blocks are much larger than BRAM but are limited to a single port and 16-bit data bus.</p>
<p>In this quick <a href="/howto">how to</a>, we learn how to use SPRAM with Yosys and contrast it with Block RAM. If you want to learn more about other FPGA memory, see <a href="/posts/fpga-memory-types/">FPGA Memory Types</a>. This post was last updated in September 2021.</p>
<p><em>Get in touch with <a href="https://mastodon.social/@WillFlux">@WillFlux</a> or join me on <a href="https://github.com/projf/projf-explore/discussions">GitHub Discussions</a> and <a href="https://discord.gg/cf869yDbXf">1BitSquared Discord</a>.</em></p>
<blockquote>
<p><strong>Sponsor My Work</strong><br>
If you like what I do, consider <a href="https://github.com/sponsors/WillGreen">sponsoring me</a> on GitHub.<br>
I love FPGAs and want to help more people discover and use them in their projects.<br>
My hardware designs are open source, and my blog is advert free.</p>
</blockquote>
<h2 id="specification">Specification</h2>
<p>iCE40 UltraPlus FPGAs include four 256 Kb SPRAM blocks organized as 16K x 16-bit (16,384 locations of 16 bits each). You can combine these blocks to create wider or deeper memories. For example, you can create a 32-bit memory by combining two SPRAM blocks to form a 16K x 32-bit memory (64 KiB).</p>
<h2 id="using-spram">Using SPRAM</h2>
<p>SPRAM is easy to use, but you need to explicitly request SPRAM: Yosys won&rsquo;t infer it for you.<br>
The SPRAM primitive is named <strong>SB_SPRAM256KA</strong>.</p>
<p>See the <a href="#compared-with-block-ram">comparison with Block RAM</a> for more details on which memory is best for your design.</p>
<h3 id="example-verilog-module">Example Verilog Module</h3>
<p>Here&rsquo;s a simple Verilog wrapper around a single 256 Kb SPRAM block that works with Yosys:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span><span style="color:#66d9ef">module</span> spram #(
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">localparam</span> WIDTH<span style="color:#f92672">=</span><span style="color:#ae81ff">16</span>,     <span style="color:#75715e">// fixed data width: 16-bits
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">localparam</span> DEPTH<span style="color:#f92672">=</span><span style="color:#ae81ff">16384</span>,  <span style="color:#75715e">// fixed depth: 16K 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">localparam</span> ADDRW<span style="color:#f92672">=</span>$clog2(DEPTH)
</span></span><span style="display:flex;"><span>    ) (
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">input</span> <span style="color:#66d9ef">wire</span> <span style="color:#66d9ef">logic</span> clk,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">input</span> <span style="color:#66d9ef">wire</span> <span style="color:#66d9ef">logic</span> [<span style="color:#ae81ff">3</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] we,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">input</span> <span style="color:#66d9ef">wire</span> <span style="color:#66d9ef">logic</span> [ADDRW<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] addr,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">input</span> <span style="color:#66d9ef">wire</span> <span style="color:#66d9ef">logic</span> [WIDTH<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] data_in,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">output</span>     <span style="color:#66d9ef">logic</span> [WIDTH<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] data_out
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    SB_SPRAM256KA spram_inst (
</span></span><span style="display:flex;"><span>        .ADDRESS(addr),
</span></span><span style="display:flex;"><span>        .DATAIN(data_in),
</span></span><span style="display:flex;"><span>        .MASKWREN(we),
</span></span><span style="display:flex;"><span>        .WREN(<span style="color:#f92672">|</span>we),
</span></span><span style="display:flex;"><span>        .CHIPSELECT(<span style="color:#ae81ff">1</span><span style="color:#ae81ff">&#39;b1</span>),
</span></span><span style="display:flex;"><span>        .CLOCK(clk),
</span></span><span style="display:flex;"><span>        .STANDBY(<span style="color:#ae81ff">1</span><span style="color:#ae81ff">&#39;b0</span>),
</span></span><span style="display:flex;"><span>        .SLEEP(<span style="color:#ae81ff">1</span><span style="color:#ae81ff">&#39;b0</span>),
</span></span><span style="display:flex;"><span>        .POWEROFF(<span style="color:#ae81ff">1</span><span style="color:#ae81ff">&#39;b1</span>),
</span></span><span style="display:flex;"><span>        .DATAOUT(data_out)
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">endmodule</span>
</span></span></code></pre></div><p>This example uses a 4-bit write enable signal, <code>we</code>, to select individual nibbles for write. If any of the bits of <code>we</code> are set, then <code>WREN</code> is enabled for writing. All the ports are described in the next section.</p>
<h3 id="port-summary">Port Summary</h3>
<p>The SB_SPRAM256KA primitive has the following ports:</p>
<table>
<thead>
<tr>
<th>Port</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ADDRESS [13:0]</td>
<td><code>14'h0</code></td>
<td>Memory address</td>
</tr>
<tr>
<td>DATAIN  [15:0]</td>
<td><code>16'h0</code></td>
<td>Value to write</td>
</tr>
<tr>
<td>MASKWREN [3:0]</td>
<td><code>4'b1111</code></td>
<td>Select nibbles for writing</td>
</tr>
<tr>
<td>WREN</td>
<td><code>1'b0</code></td>
<td>Write enable (active high)</td>
</tr>
<tr>
<td>CHIPSELECT</td>
<td><code>1'b0</code></td>
<td>Enable block (active high)</td>
</tr>
<tr>
<td>CLOCK</td>
<td><code>N/A</code></td>
<td>Clock for memory</td>
</tr>
<tr>
<td>STANDBY</td>
<td><code>1'b0</code></td>
<td>Light sleep (active high)</td>
</tr>
<tr>
<td>SLEEP</td>
<td><code>1'b0</code></td>
<td>Deep sleep (active high)</td>
</tr>
<tr>
<td>POWEROFF</td>
<td><code>1'b1</code></td>
<td>Turn off memory (active low)</td>
</tr>
<tr>
<td>DATAOUT [15:0]</td>
<td><code>N/A</code></td>
<td>Output value from memory read</td>
</tr>
</tbody>
</table>
<p>All ports are inputs apart from DATAOUT.<br>
For details on the sleep and power pins see the <a href="https://www.latticesemi.com/view_document?document_id=51966">iCE40 SPRAM Usage Guide</a>.</p>
<h3 id="write-mask">Write Mask</h3>
<p>SPRAM has a fixed 16-bit data bus, but you can select individual nibbles (4 bits) for writing with <code>MASKWREN</code>. CPUs usually expect memory to be byte writeable; the write mask allows you to trivially support byte writes. 4-bit writes are more unusual but come in handy when working with SPI devices or 16 colour (4 bit) graphics.</p>
<p>For example, with <code>MASKWREN(4'b1100)</code>, the upper byte of <code>DATAIN</code> is written to memory.</p>
<h3 id="initializing-spram">Initializing SPRAM</h3>
<p>Unlike Block RAM, SPRAM cannot be initialized by device configuration, so you can&rsquo;t use <code>$readmemh</code>. SPRAM starts out with undefined values, which you need to explicitly initialize in logic if required.</p>
<h2 id="compared-with-block-ram">Compared with Block RAM</h2>
<p>The following comparison can help you decide between SPRAM and block RAM:</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>SPRAM</th>
<th>Block RAM (EBR)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ports</td>
<td>One (Shared by Read &amp; Write)</td>
<td>Separate Read &amp; Write or one R/W</td>
</tr>
<tr>
<td>Data Width</td>
<td>Fixed 16 bit (4-bit write mask)</td>
<td>2, 4, 8, or 16 bit</td>
</tr>
<tr>
<td>Block Size</td>
<td>256 Kb (32 KiB)</td>
<td>4 Kb (512 bytes)</td>
</tr>
<tr>
<td>Block Count</td>
<td>4</td>
<td>30 (UP5K) or 20 (UP3K)</td>
</tr>
<tr>
<td>Total Size</td>
<td>1024 Kb</td>
<td>120 Kb (UP5K) or 80 Kb (UP3K)</td>
</tr>
<tr>
<td>Init Values</td>
<td>No</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<p>NB. There are two models of UltraPlus, UP3K and UP5K, but both include the full 1 Mb of SPRAM.</p>
<h2 id="project-ideas">Project Ideas</h2>
<p>If you&rsquo;re doing CPU development, try combining two SPRAM blocks to make a 32-bit wide, 64 KiB memory. I&rsquo;ll be adding examples of SPRAM as a framebuffer in future.</p>
<h2 id="ice40up-boards">iCE40UP Boards</h2>
<p>The following boards include the iCE40UP5K FPGA:</p>
<ul>
<li>1BitSquared <a href="https://docs.icebreaker-fpga.org/hardware/icebreaker/">iCEBreaker</a></li>
<li>1BitSquared <a href="https://docs.icebreaker-fpga.org/hardware/bitsy/">iCEBreaker Bitsy</a></li>
<li>Lattice <a href="https://www.latticesemi.com/Products/DevelopmentBoardsAndKits/iCE40UltraPlusBreakoutBoard">iCE40 UltraPlus Breakout Board</a></li>
</ul>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="https://www.latticesemi.com/view_document?document_id=51968">iCE40 UltraPlus Family Data Sheet</a> (PDF)</li>
<li><a href="https://www.latticesemi.com/view_document?document_id=51966">iCE40 SPRAM Usage Guide</a> (PDF)</li>
</ul>
<p><em>Get in touch with <a href="https://mastodon.social/@WillFlux">@WillFlux</a> or join me on <a href="https://github.com/projf/projf-explore/discussions">GitHub Discussions</a> and <a href="https://discord.gg/cf869yDbXf">1BitSquared Discord</a>.</em></p>

      
    </div>
    
  </div>
</section>

    <script src="/js/copycode.js"></script>



<section class="section">
  <div class="container has-text-centered">
    <p>©2023 Will Green, Project F</p>
    
  </div>
</section>


<script src="https://badgers.projectf.io/script.js" data-site="EVCGKVDN" defer></script>



</body>
</html>

