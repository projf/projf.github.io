<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en-gb">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Animated Shapes | Project F: FPGA Dev</title>

<meta property='og:title' content='Animated Shapes - Project F: FPGA Dev'>
<meta property='og:description' content='Welcome back to Exploring FPGA Graphics. In the final part of our introductory graphics series, we&rsquo;re looking at animation. We&rsquo;ve already seen animation with hardware sprites, but double buffering gives us maximum creative freedom with fast, tear-free motion. We&rsquo;ll be making extensive use of our designs from 2D Shapes, so have a look back at that post if you need a refresher on drawing shapes.
This post is being completely revised during October 2022.'>
<meta property='og:url' content='https://projectf.io/posts/animated-shapes/'>
<meta property='og:site_name' content='Project F: FPGA Dev'>
<meta property='og:type' content='article'><meta property='og:image' content='https://projectf.io/img/posts/animated-shapes/social-card.png'><meta property='article:published_time' content='2021-08-31T00:00:00Z'><meta property='article:modified_time' content='2022-10-07T00:00:00Z'><meta name='twitter:card' content='summary_large_image'><meta name='twitter:site' content='@WillFlux'><meta name='twitter:creator' content='@WillFlux'>


<link href="https://projectf.io/index.xml" rel="alternate" type="application/rss+xml" title="Project F: FPGA Dev">

<link rel="stylesheet" href="/css/style.css"><link rel='stylesheet' href='https://projectf.io/css/custom.css'>

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<link rel="canonical" href="https://projectf.io/posts/animated-shapes/">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>

<section class="section">
  <div class="container">
    <nav id="nav-main" class="nav">
      <div id="nav-name" class="nav-left">
        <a id="nav-anchor" class="nav-item" href="https://projectf.io">
          <h1 id="nav-heading" class="title is-4">Project F: FPGA Dev</h1>
        </a>
      </div>
      <div class="nav-right">
        <nav id="nav-items" class="nav-item level is-mobile"><a class="level-item" aria-label="github" href='https://github.com/projf/projf-explore'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="twitter" href='https://twitter.com/WillFlux'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="youtube" href='https://youtube.com/channel/UCaT0lvfWo1GStbp0neg8weg'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"/>
    <polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="rss" href='/index.xml'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle>
    
  </svg></i>
            </span>
          </a></nav>
      </div>
    </nav>

    <nav class="nav">
      
      <div class="nav-left"><a class="nav-item" href="/about">
          <h2 class="title is-5">About</h2>
        </a><a class="nav-item" href="/boards">
          <h2 class="title is-5">Boards</h2>
        </a><a class="nav-item" href="/demos">
          <h2 class="title is-5">Demos</h2>
        </a><a class="nav-item" href="/howto">
          <h2 class="title is-5">How To</h2>
        </a><a class="nav-item" href="/tags/news">
          <h2 class="title is-5">News</h2>
        </a><a class="nav-item" href="/tutorials">
          <h2 class="title is-5">Tutorials</h2>
        </a><a class="nav-item" href="/verilog-lib">
          <h2 class="title is-5">Verilog Lib</h2>
        </a></div>
      

      
    </nav>

  </div>
  <script src="/js/navicon-shift.js"></script>
</section>
<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
      
<a class="subtitle is-6" href="/tags/graphics/">#graphics</a>




      
    </div>
    <h2 class="subtitle is-6">31 August 2021</h2>
    <h1 class="title">Animated Shapes</h1>
    
    <div class="content">
      <p>Welcome back to <em>Exploring FPGA Graphics</em>. In the final part of our introductory graphics series, we&rsquo;re looking at animation. We&rsquo;ve already seen animation with <a href="/posts/hardware-sprites/">hardware sprites</a>, but double buffering gives us maximum creative freedom with fast, tear-free motion. We&rsquo;ll be making extensive use of our designs from <a href="/posts/fpga-shapes/">2D Shapes</a>, so have a look back at that post if you need a refresher on drawing shapes.</p>
<p><strong>This post is being completely revised during October 2022.</strong></p>
<p>In this series, we learn about graphics at the hardware level and get a feel for the power of FPGAs. We&rsquo;ll learn how screens work, play Pong, create starfields and sprites, paint Michelangelo&rsquo;s David, draw lines and triangles, and animate characters and shapes. New to the series? Start with <a href="/posts/fpga-graphics/">Beginning FPGA Graphics</a>.</p>
<p><em>Get in touch: <a href="https://github.com/projf/projf-explore/issues">GitHub Issues</a>, <a href="https://1bitsquared.com/pages/chat">1BitSquared Discord</a>, <a href="https://mastodon.social/@WillFlux">@WillFlux</a> (Mastodon), <a href="https://twitter.com/WillFlux">@WillFlux</a> (Twitter)</em></p>
<p><img src="/img/posts/animated-shapes/banner.png" alt="" title=""></p>
<h3 id="series-outline">Series Outline</h3>
<ul>
<li><a href="/posts/fpga-graphics/">Beginning FPGA Graphics</a> - video signals and basic graphics</li>
<li><a href="/posts/racing-the-beam/">Racing the Beam</a> - simple demos with minimal logic</li>
<li><a href="/posts/fpga-pong/">FPGA Pong</a> - recreate the classic arcade on an FPGA</li>
<li><a href="/posts/display-signals/">Display Signals</a> - revisit display signals and meet colour palettes</li>
<li><a href="/posts/hardware-sprites/">Hardware Sprites</a> - fast, colourful graphics for games</li>
<li><a href="/posts/framebuffers/">Framebuffers</a> - bitmap graphics featuring Michelangelo&rsquo;s David</li>
<li><a href="/posts/lines-and-triangles/">Lines and Triangles</a> - drawing lines and triangles</li>
<li><a href="/posts/fpga-shapes/">2D Shapes</a> - filled shapes and simple pictures</li>
<li>Animated Shapes (this post) - animation and double-buffering</li>
</ul>
<blockquote>
<p><strong>Sponsor My Work</strong><br>
If you like what I do, consider <a href="https://github.com/sponsors/WillGreen">sponsoring me</a> on GitHub.<br>
I love FPGAs and want to help more people discover and use them in their projects.<br>
My hardware designs are open source, and my blog is advert free.</p>
</blockquote>
<h3 id="requirements">Requirements</h3>
<p>You should be to run these designs on any recent FPGA board. I include everything you need for the <a href="https://docs.icebreaker-fpga.org/hardware/icebreaker/">iCEBreaker</a> with <a href="https://docs.icebreaker-fpga.org/hardware/pmod/dvi/">12-Bit DVI Pmod</a>, <a href="https://digilent.com/reference/programmable-logic/arty-a7/reference-manual">Digilent Arty A7-35T</a> with <a href="https://digilent.com/reference/pmod/pmodvga/reference-manual">Pmod VGA</a>, and <a href="/posts/verilog-sim-verilator-sdl/">Verilator Simulation with SDL</a>. See <a href="/posts/fpga-graphics/#requirements">requirements</a> from <em>Beginning FPGA Graphics</em> for more details.</p>
<h2 id="blazing-a-trail">Blazing a Trail</h2>
<p>Early on this series, we <a href="/posts/racing-the-beam/#bounce">animated a bouncing square</a>; now we&rsquo;re going to do it with a framebuffer. We take a filled square and bounce it around the screen, changing its colour every frame. This design uses a single framebuffer hence the &lsquo;sb&rsquo; name.</p>
<ul>
<li>Arty (XC7): <strong><a href="https://github.com/projf/projf-explore/blob/main/graphics/animated-shapes/xc7/top_demo_sb.sv">xc7/top_demo_sb.sv</a></strong></li>
<li>iCEBreaker (iCE40): <strong><a href="https://github.com/projf/projf-explore/blob/main/graphics/animated-shapes/ice40/top_demo_sb.sv">ice40/top_demo_sb.sv</a></strong></li>
<li>Verilator Sim: <strong><a href="https://github.com/projf/projf-explore/blob/main/graphics/animated-shapes/sim/top_demo_sb.sv">sim/top_demo_sb.sv</a></strong></li>
</ul>
<p>The square rendering module:</p>
<ul>
<li><strong><a href="https://github.com/projf/projf-explore/blob/main/graphics/animated-shapes/160x90/render_square_colr.sv">160x90/render_square_colr.sv</a></strong></li>
<li><strong><a href="https://github.com/projf/projf-explore/blob/main/graphics/animated-shapes/320x180/render_square_colr.sv">320x180/render_square_colr.sv</a></strong></li>
</ul>
<blockquote>
<p><strong>Building the Designs</strong><br>
In the <a href="https://github.com/projf/projf-explore/tree/main/graphics/animated-shapes">Animated Shapes</a> section of the git repo, you&rsquo;ll find the design files, a makefile for iCEBreaker and Verilator, and a Vivado project for Arty. There are also build instructions for boards and simulations.</p>
</blockquote>
<p><img src="/img/posts/animated-shapes/bounce-sb.png" alt="Bounce Single Buffer" title="Stripey! Captured from my FPGA board."></p>
<p>Our framebuffer remembers all the squares we&rsquo;ve drawn, so the screen gradually fills with striped colour. While this is a fun effect, it&rsquo;s not usually what you want.</p>
<h3 id="clean-movement">Clean Movement</h3>
<p>There are three approaches we can take to move an object around the screen cleanly:</p>
<ol>
<li>Use <a href="/posts/hardware-sprites/">hardware sprites</a> - suitable for simple 2D graphics</li>
<li>Use a blitter to cut out and move a framebuffer region  - effective for small 2D objects</li>
<li>Clear the framebuffer and draw from scratch - versatile but requires plenty of bandwidth</li>
</ol>
<p>For this post, we&rsquo;ll go with option 3, but more than that, we&rsquo;ll also introduce double buffering.</p>
<h2 id="double-buffering">Double Buffering</h2>
<p>We can&rsquo;t draw in a framebuffer while the display controller reads it; otherwise, we&rsquo;ll get <a href="https://en.wikipedia.org/wiki/Screen_tearing">tearing</a>. We could limit ourselves to drawing in the vertical blanking interval, but even for 640x480 with its generous blanking, we&rsquo;d only be able to draw for less than 10% of the time. This is not enough time to do much interesting, especially as we need to clear the framebuffer of old designs every frame.</p>
<p>To draw all the time, we can double up on framebuffers: drawing in one while the display controller reads from the other. That way, we can be drawing all the time and avoid screen tearing. The only downsides are the need for twice the memory, and an extra frame of latency before the new output is visible.</p>
<p>Double-buffer:</p>
<ul>
<li>Arty (XC7): <strong>[<a href="https://github.com/projf/projf-explore/blob/main/graphics/animated-shapes/xc7/top_demo.sv">xc7/top_demo.sv</a>]</strong></li>
<li>iCEBreaker (iCE40): <strong>[<a href="https://github.com/projf/projf-explore/blob/main/graphics/animated-shapes/ice40/top_demo.sv">ice40/top_demo.sv</a>]</strong></li>
<li>Verilator Sim: <strong><a href="https://github.com/projf/projf-explore/blob/main/graphics/animated-shapes/sim/top_demo.sv">sim/top_demo.sv</a></strong></li>
</ul>
<p><em>Explanation being written October 2022&hellip;</em></p>
<h3 id="shattered-cube">Shattered Cube</h3>
<p>Back when we learnt about <a href="/posts/fpga-shapes/#filled-triangle">filled triangles</a> we built a cube, now we can tear it apart:</p>
<ul>
<li><strong><a href="https://github.com/projf/projf-explore/blob/main/graphics/animated-shapes/160x90/render_square_colr.sv">160x90/render_cube_shatter.sv</a></strong></li>
<li><strong><a href="https://github.com/projf/projf-explore/blob/main/graphics/animated-shapes/320x180/render_square_colr.sv">320x180/render_cube_shatter.sv</a></strong></li>
</ul>
<p>Replace replace <code>render_*</code> with <code>render_cube_shatter</code> in your top module and rebuild.</p>
<h3 id="teleport">Teleport</h3>
<p><img src="/img/posts/animated-shapes/teleport.png" alt="Teleport!"></p>
<p>Using our double-buffer and a few animated rectangles we can create a teleport effect:</p>
<ul>
<li><strong><a href="https://github.com/projf/projf-explore/blob/main/graphics/animated-shapes/160x90/render_teleport.sv">160x90/render_teleport.sv</a></strong></li>
<li><strong><a href="https://github.com/projf/projf-explore/blob/main/graphics/animated-shapes/320x180/render_teleport.sv">320x180/render_teleport.sv</a></strong></li>
</ul>
<p>Replace replace <code>render_*</code> with <code>render_teleport</code> in your top module and rebuild.</p>
<h2 id="explore">Explore</h2>
<p>I hope you enjoyed this instalment of <em>Exploring FPGA Graphics</em>, but nothing beats creating your own designs. Here are a few suggestions to get you started:</p>
<p><em>Suggestions will be added shortly.</em></p>
<h2 id="what-next">What Next?</h2>
<p>This is the end of the current series of FPGA Graphics. Watch out for a future series covering more advanced graphics. Until then, why not check out my FPGA <a href="/demos/">demos</a> and <a href="/tutorials/">tutorials</a> for more FPGA projects.</p>
<p><em>Get in touch: <a href="https://github.com/projf/projf-explore/issues">GitHub Issues</a>, <a href="https://1bitsquared.com/pages/chat">1BitSquared Discord</a>, <a href="https://mastodon.social/@WillFlux">@WillFlux</a> (Mastodon), <a href="https://twitter.com/WillFlux">@WillFlux</a> (Twitter)</em></p>

      
    </div>
    
  </div>
</section>



<section class="section">
  <div class="container has-text-centered">
    <p>©2022 Will Green, Project F</p>
    
  </div>
</section>


<script src="https://badgers.projectf.io/script.js" data-site="EVCGKVDN" defer></script>



</body>
</html>

