<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en-gb">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>Division in Verilog | Project F - FPGA Development</title>

<meta property='og:title' content='Division in Verilog - Project F - FPGA Development'>
<meta property='og:description' content='Division is a fundamental arithmetic operation; one we take for granted in most contexts. FPGAs are different; Verilog can&rsquo;t synthesize division: we need to do it ourselves. In this FPGA recipe, we&rsquo;re going to look at a straightforward division algorithm for positive integers and fixed-point numbers. For integers, this method takes one cycle per bit: 32 cycles for 32-bit numbers. You might also be interested in Square Root in Verilog.'>
<meta property='og:url' content='https://projectf.io/posts/division-in-verilog/'>
<meta property='og:site_name' content='Project F - FPGA Development'>
<meta property='og:type' content='article'><meta property='og:image' content='https://projectf.io/img/posts/division-in-verilog/social-card.png'><meta property='article:published_time' content='2020-07-01T00:00:00Z'/><meta property='article:modified_time' content='2020-07-01T00:00:00Z'/><meta name='twitter:card' content='summary_large_image'><meta name='twitter:site' content='@WillFlux'><meta name='twitter:creator' content='@WillFlux'>


<link href="https://projectf.io/index.xml" rel="alternate" type="application/rss+xml" title="Project F - FPGA Development" />

<link rel="stylesheet" href="/css/style.css"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<link rel="canonical" href="https://projectf.io/posts/division-in-verilog/">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
<meta name="referrer" content="no-referrer, same-origin">
</head>
<body>
<section class="section">
  <div class="container">
    <nav id="nav-main" class="nav">
      <div id="nav-name" class="nav-left">
        <a id="nav-anchor" class="nav-item" href="https://projectf.io">
          <h1 id="nav-heading" class="title is-4">Project F - FPGA Development</h1>
        </a>
      </div>
      <div class="nav-right">
        <nav id="nav-items" class="nav-item level is-mobile"><a class="level-item" aria-label="github" href='https://github.com/projf'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="twitter" href='https://twitter.com/WillFlux'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="youtube" href='https://youtube.com/channel/UCaT0lvfWo1GStbp0neg8weg'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"/>
    <polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="rss" href='/index.xml'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle>
    
  </svg></i>
            </span>
          </a></nav>
      </div>
    </nav>

    <nav class="nav">
      
      <div class="nav-left"><a class="nav-item" href="/about">
          <h2 class="title is-5">About</h2>
        </a><a class="nav-item" href="/sitemap">
          <h2 class="title is-5">Sitemap</h2>
        </a><a class="nav-item" href="/tags/cookbook">
          <h2 class="title is-5">Cookbook</h2>
        </a><a class="nav-item" href="/tags/explore">
          <h2 class="title is-5">Explore</h2>
        </a><a class="nav-item" href="/tags/tools">
          <h2 class="title is-5">Tools</h2>
        </a></div>
      

      
    </nav>

  </div>
  <script src="/js/navicon-shift.js"></script>
</section>
<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
      
<a class="subtitle is-6" href="/tags/cookbook/">#cookbook</a>



  
  | <a class="subtitle is-6" href="/tags/maths/">#maths</a>
  


      
    </div>
    <h2 class="subtitle is-6">1 July 2020</h2>
    <h1 class="title">Division in Verilog</h1>
    
    <div class="content">
      <p>Division is a fundamental arithmetic operation; one we take for granted in most contexts. FPGAs are different; Verilog can&rsquo;t synthesize division: we need to do it ourselves. In this <a href="/tags/cookbook">FPGA recipe</a>, we&rsquo;re going to look at a straightforward division algorithm for positive integers and <a href="/posts/fixed-point-numbers-in-verilog/">fixed-point numbers</a>. For integers, this method takes one cycle per bit: 32 cycles for 32-bit numbers. You might also be interested in <a href="/posts/square-root-in-verilog/">Square Root in Verilog</a>.</p>
<p><em>Updated 2021-01-04. Feedback to <a href="https://twitter.com/WillFlux">@WillFlux</a> is most welcome.</em></p>
<h2 id="division-defined">Division Defined</h2>
<p>Before we get to the design, it helps be familiar with some terminology.</p>
<p>When you divide <strong>dividend</strong> <code>X</code> by <strong>divisor</strong> <code>Y</code> you get <strong>quotient</strong> <code>Q</code> and <strong>remainder</strong> <code>R</code>:</p>
<p><code>X = Y*Q + R</code></p>
<p>Consider a trivial example: you have seven slices of apple pie to divide equally amongst three people. Each person gets two slices of pie, and there is one slice left over.</p>
<p>Less deliciously: given <code>X=7</code> and <code>Y=3</code>, then <code>Q=2</code> and <code>R=1</code> because <code>7 = 3*2 + 1</code>.</p>
<h2 id="long-division">Long Division</h2>
<p>The traditional way to divide numbers with pen and paper is <a href="https://en.wikipedia.org/wiki/Long_division">long division</a>. We move from left to right, trying to divide the shortest sequence of digits in the dividend by the divisor.</p>
<p>For example, let&rsquo;s divide <code>512</code> by <code>12</code>. We find that <code>12</code> is larger <code>5</code> (the first digit of the dividend), so we next consider <code>51</code>, which <code>12</code> divides <code>4</code> times, with <code>3</code> left over. So, the first digit of our answer is 4.</p>
<p>Next, we take the leftover <code>3</code>, and bring down the <code>2</code> from <code>512</code>, to make <code>32</code>. <code>12</code> fits into <code>32</code> twice, so the second digit of our answer is <code>2</code> with <code>8</code> left over. We&rsquo;ve considered all the digits of the dividend, so the quotient is <code>42</code> and the remainder is <code>8</code>.</p>
<p>This is easier to see when laid out as a calculation in columns:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">    X=512  Y=12

         42    Quotient
       ————
    12 )512
        48     51: 12x4=48 + 3
        ——
         32    Take the 3 and bring down the 2 down from 512
         24    32: 12x2=24 + 8
         ——
          8    Remainder
</code></pre></div><p>If this doesn&rsquo;t seem clear, check out the Wikipedia page on <a href="https://en.wikipedia.org/wiki/Long_division">long division</a> and try doing a few calculations yourself. Nothing beats doing hands-on examples when it comes to maths.</p>
<h3 id="in-binary">In Binary</h3>
<p>For binary, we can follow the same long division process. For example, let&rsquo;s divide <code>1110</code> by <code>11</code> (that&rsquo;s 14 divided by 3 in decimal).</p>
<p>Our divisor <code>11</code> is two digits long, so we can start by considering the first two digits of the dividend, which is also <code>11</code>: we record a <code>1</code> for the first digit of the quotient and move on.</p>
<p>The remaining digits are <code>10</code>, which is smaller than <code>11</code>, so we stop. We have a quotient of <code>100</code> and a remainder of <code>10</code>. This is easier to see when laid out in columns:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">    X=1110  Y=11

         100    Quotient
        ————
    11 )1110
        11      11x1=11 + 0
        ——
         010    Bring third 1 down from 1110
         000    11 doesn&#39;t divide 10, so it&#39;s the remainder
         ———
          10    Remainder
</code></pre></div><p>Doing binary division by hand is painful: each step is simple, but even moderately-sized numbers have a large number of digits, all of which are 1 and 0, so it&rsquo;s easy to make a mistake. However, the very simplicity of the approach makes it straightforward to implement in Verilog.</p>
<blockquote>
<p><strong>Quick Aside: Divide is typically much slower than Multiply</strong><br>
Even high-end CPUs take their time with division. Intel Skylake has a latency of 42-95 cycles for signed 64-bit integer division, but only 3 cycles for multiplication. Source: <a href="https://www.agner.org/optimize/instruction_tables.pdf">agner.org</a>.</p>
</blockquote>
<h2 id="algorithm-implementation">Algorithm Implementation</h2>
<p>We&rsquo;ll take our example from above: <code>X=1110</code> and <code>Y=0011</code>. We also need a register to accumulate (store) the intermediate calculations, and a register to record the quotient: we name them <code>A</code> and <code>Q</code> respectively.</p>
<p>There are four digits in the inputs, so we need four steps. For each step, we shift the left-most digit of the dividend <code>X</code> into <code>A</code>, then compare it with the divisor <code>Y</code>. If <code>A</code> is greater or equal to <code>Y</code>, then we subtract <code>Y</code> from <code>A</code> and add 1 to the quotient <code>Q</code>.</p>
<p>This is easiest to see by working through the example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">Inputs: X=1110  Y=0011

Step    A       X       Q       Description
——————————————————————————————————————————————————————————————————
        0000    1110    0000    Starting values.
1       0001    1100    0000    Left shift X into A. Left shift Q.
                                Is A≥Y? No: next digit...
2       0011    1000    0000    Left shift X into A. Left shift Q.
                                Is A≥Y? Yes: update quotient...
        0000    1000    0001    Subtract Y from A. Set Q[0]=1.
3       0001    0000    0010    Left shift X into A. Left shift Q.
                                Is A≥Y? No: next digit...
4       0010    0000    0100    Left shift X into A. Left shift Q.
                                Is A≥Y? No. Done.
——————————————————————————————————————————————————————————————————

Outputs: Q=0100  R=010
</code></pre></div><p>With this algorithm, the divisor <code>Y</code> can only ever fit into the accumulator <code>A</code> once at most, which is why we can simply subtract <code>Y</code> from <code>A</code> when <code>A≥Y</code>.</p>
<p>We never use the same digit in <code>X</code> and <code>Q</code> at the same time, so it&rsquo;s possible to combine those registers together. As a digit of the dividend is shifted out, a digit of the quotient is shifted in. We&rsquo;ll do this in our Verilog module.</p>
<h2 id="verilog-module">Verilog Module</h2>
<p>Our Verilog design uses the above algorithm, but adds a check for divide by zero and allows the width of the numbers to be configured.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog"><span style="color:#75715e">// Project F: Division (Integer)
</span><span style="color:#75715e">// (C)2021 Will Green, Open source hardware released under the MIT License
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">`default_nettype</span> none
<span style="color:#66d9ef">`timescale</span> <span style="color:#ae81ff">1</span>ns <span style="color:#f92672">/</span> <span style="color:#ae81ff">1</span>ps

<span style="color:#66d9ef">module</span> div_int #(<span style="color:#66d9ef">parameter</span> WIDTH<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>) (
    <span style="color:#66d9ef">input</span> <span style="color:#66d9ef">wire</span> <span style="color:#66d9ef">logic</span> clk,
    <span style="color:#66d9ef">input</span> <span style="color:#66d9ef">wire</span> <span style="color:#66d9ef">logic</span> start,          <span style="color:#75715e">// start signal
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">output</span>     <span style="color:#66d9ef">logic</span> busy,           <span style="color:#75715e">// calculation in progress
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">output</span>     <span style="color:#66d9ef">logic</span> valid,          <span style="color:#75715e">// quotient and remainder are valid
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">output</span>     <span style="color:#66d9ef">logic</span> dbz,            <span style="color:#75715e">// divide by zero flag
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">input</span> <span style="color:#66d9ef">wire</span> <span style="color:#66d9ef">logic</span> [WIDTH<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] x,  <span style="color:#75715e">// dividend
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">input</span> <span style="color:#66d9ef">wire</span> <span style="color:#66d9ef">logic</span> [WIDTH<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] y,  <span style="color:#75715e">// divisor
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">output</span>     <span style="color:#66d9ef">logic</span> [WIDTH<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] q,  <span style="color:#75715e">// quotient
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">output</span>     <span style="color:#66d9ef">logic</span> [WIDTH<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] r   <span style="color:#75715e">// remainder
</span><span style="color:#75715e"></span>    );

    <span style="color:#66d9ef">logic</span> [WIDTH<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] y1;            <span style="color:#75715e">// copy of divisor
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> [WIDTH<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] q1, q1_next;   <span style="color:#75715e">// intermediate quotient
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> [WIDTH:<span style="color:#ae81ff">0</span>] ac, ac_next;     <span style="color:#75715e">// accumulator (1 bit wider)
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> [$clog2(WIDTH)<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] i;     <span style="color:#75715e">// iteration counter
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">always_comb</span> <span style="color:#66d9ef">begin</span>
        <span style="color:#66d9ef">if</span> (ac <span style="color:#f92672">&gt;=</span> {<span style="color:#ae81ff">1</span><span style="color:#ae81ff">&#39;b0</span>,y1}) <span style="color:#66d9ef">begin</span>
            ac_next <span style="color:#f92672">=</span> ac <span style="color:#f92672">-</span> y1;
            {ac_next, q1_next} <span style="color:#f92672">=</span> {ac_next[WIDTH<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>], q1, <span style="color:#ae81ff">1</span><span style="color:#ae81ff">&#39;b1</span>};
        <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">begin</span>
            {ac_next, q1_next} <span style="color:#f92672">=</span> {ac, q1} <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>;
        <span style="color:#66d9ef">end</span>
    <span style="color:#66d9ef">end</span>

    <span style="color:#66d9ef">always_ff</span> @(<span style="color:#66d9ef">posedge</span> clk) <span style="color:#66d9ef">begin</span>
        <span style="color:#66d9ef">if</span> (start) <span style="color:#66d9ef">begin</span>
            valid <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
            i <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
            <span style="color:#66d9ef">if</span> (y <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">begin</span>  <span style="color:#75715e">// catch divide by zero
</span><span style="color:#75715e"></span>                busy <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
                dbz <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>;
            <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">begin</span>  <span style="color:#75715e">// initialize values
</span><span style="color:#75715e"></span>                busy <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>;
                dbz <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
                y1 <span style="color:#f92672">&lt;=</span> y;
                {ac, q1} <span style="color:#f92672">&lt;=</span> {{WIDTH{<span style="color:#ae81ff">1</span><span style="color:#ae81ff">&#39;b0</span>}}, x, <span style="color:#ae81ff">1</span><span style="color:#ae81ff">&#39;b0</span>};
            <span style="color:#66d9ef">end</span>
        <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (busy) <span style="color:#66d9ef">begin</span>
            <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">==</span> WIDTH<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">begin</span>  <span style="color:#75715e">// we&#39;re done
</span><span style="color:#75715e"></span>                busy <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
                valid <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>;
                q <span style="color:#f92672">&lt;=</span> q1_next;
                r <span style="color:#f92672">&lt;=</span> ac_next[WIDTH:<span style="color:#ae81ff">1</span>];  <span style="color:#75715e">// undo final shift
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">begin</span>  <span style="color:#75715e">// next iteration
</span><span style="color:#75715e"></span>                i <span style="color:#f92672">&lt;=</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
                ac <span style="color:#f92672">&lt;=</span> ac_next;
                q1 <span style="color:#f92672">&lt;=</span> q1_next;
            <span style="color:#66d9ef">end</span>
        <span style="color:#66d9ef">end</span>
    <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">endmodule</span>
</code></pre></div><p><em>ProTip: I&rsquo;ve used SystemVerilog, but you can easily adapt <code>logic</code>, <code>$clog2</code>, and always* to Verilog.</em></p>
<p>To use the module, set <code>WIDTH</code> to the correct number of bits and the inputs <code>x</code> and <code>y</code> to dividend and divisor respectively. To begin the calculation set <code>start</code> high for one clock. The <code>valid</code> signal indicates when the output data is valid; you can then read the results from <code>q</code> and <code>r</code>. If you divide by zero, then <code>valid</code>, <code>q</code>, and <code>r</code> will be zero, and the <code>dbz</code> flag signal will be high. The <code>busy</code> signal is high during calculation.</p>
<p>The Verilog itself is straightforward. The algorithm is in the <code>always_comb</code> block, though we start with the initial shift already in place. The <code>always_ff</code> block tests for division by zero, sets up the initial values, then runs the algorithm for the same number of iterations as the width of the numbers.</p>
<h3 id="testing">Testing</h3>
<p>The following test bench exercises the module, including dividing by zero:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog"><span style="color:#75715e">// Project F: Test Bench for Integer Division
</span><span style="color:#75715e">// (C)2021 Will Green, Open source hardware released under the MIT License
</span><span style="color:#75715e">// Learn more at https://projectf.io
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">`default_nettype</span> none
<span style="color:#66d9ef">`timescale</span> <span style="color:#ae81ff">1</span>ns <span style="color:#f92672">/</span> <span style="color:#ae81ff">1</span>ps

<span style="color:#66d9ef">module</span> div_int_tb();

    <span style="color:#66d9ef">parameter</span> CLK_PERIOD <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>;
    <span style="color:#66d9ef">parameter</span> WIDTH <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>;

    <span style="color:#66d9ef">logic</span> clk;
    <span style="color:#66d9ef">logic</span> start;            <span style="color:#75715e">// start signal
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> busy;             <span style="color:#75715e">// calculation in progress
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> valid;            <span style="color:#75715e">// quotient and remainder are valid
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> dbz;              <span style="color:#75715e">// divide by zero flag
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> [WIDTH<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] x;    <span style="color:#75715e">// dividend
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> [WIDTH<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] y;    <span style="color:#75715e">// divisor
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> [WIDTH<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] q;    <span style="color:#75715e">// quotient
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> [WIDTH<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] r;    <span style="color:#75715e">// remainder
</span><span style="color:#75715e"></span>
    div_int #(.WIDTH(WIDTH)) div_int_inst (.<span style="color:#f92672">*</span>);

    <span style="color:#66d9ef">always</span> #(CLK_PERIOD <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>) clk <span style="color:#f92672">=</span> <span style="color:#f92672">~</span>clk;

    <span style="color:#66d9ef">initial</span> <span style="color:#66d9ef">begin</span>
                clk <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;

        #<span style="color:#ae81ff">100</span>    x <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span><span style="color:#ae81ff">&#39;b0111</span>;  <span style="color:#75715e">// 7
</span><span style="color:#75715e"></span>                y <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span><span style="color:#ae81ff">&#39;b0010</span>;  <span style="color:#75715e">// 2
</span><span style="color:#75715e"></span>                start <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
        #<span style="color:#ae81ff">10</span>     start <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
        #<span style="color:#ae81ff">40</span>     $display(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%d:</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%d /%d =%d (r =%d) (DBZ=%b)&#34;</span>, $time, x, y, q, r, dbz);

                x <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span><span style="color:#ae81ff">&#39;b0000</span>;  <span style="color:#75715e">// 0
</span><span style="color:#75715e"></span>                y <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span><span style="color:#ae81ff">&#39;b0010</span>;  <span style="color:#75715e">// 2
</span><span style="color:#75715e"></span>                start <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
        #<span style="color:#ae81ff">10</span>     start <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
        #<span style="color:#ae81ff">40</span>     $display(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%d:</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%d /%d =%d (r =%d) (DBZ=%b)&#34;</span>, $time, x, y, q, r, dbz);

                x <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span><span style="color:#ae81ff">&#39;b0010</span>;  <span style="color:#75715e">// 2
</span><span style="color:#75715e"></span>                y <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span><span style="color:#ae81ff">&#39;b0000</span>;  <span style="color:#75715e">// 0
</span><span style="color:#75715e"></span>                start <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
        #<span style="color:#ae81ff">10</span>     start <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
        #<span style="color:#ae81ff">40</span>     $display(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%d:</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%d /%d =%d (r =%d) (DBZ=%b)&#34;</span>, $time, x, y, q, r, dbz);

                x <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span><span style="color:#ae81ff">&#39;b0011</span>;  <span style="color:#75715e">// 3
</span><span style="color:#75715e"></span>                y <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span><span style="color:#ae81ff">&#39;b0010</span>;  <span style="color:#75715e">// 2
</span><span style="color:#75715e"></span>                start <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
        #<span style="color:#ae81ff">10</span>     start <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
        #<span style="color:#ae81ff">40</span>     $display(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%d:</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%d /%d =%d (r =%d) (DBZ=%b)&#34;</span>, $time, x, y, q, r, dbz);

                x <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span><span style="color:#ae81ff">&#39;b1111</span>;  <span style="color:#75715e">// 15
</span><span style="color:#75715e"></span>                y <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span><span style="color:#ae81ff">&#39;b0101</span>;  <span style="color:#75715e">//  5
</span><span style="color:#75715e"></span>                start <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
        #<span style="color:#ae81ff">10</span>     start <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
        #<span style="color:#ae81ff">40</span>     $display(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%d:</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%d /%d =%d (r =%d) (DBZ=%b)&#34;</span>, $time, x, y, q, r, dbz);

                x <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span><span style="color:#ae81ff">&#39;b1101</span>;  <span style="color:#75715e">// 13
</span><span style="color:#75715e"></span>                y <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span><span style="color:#ae81ff">&#39;b0111</span>;  <span style="color:#75715e">//  7
</span><span style="color:#75715e"></span>                start <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
        #<span style="color:#ae81ff">10</span>     start <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
        #<span style="color:#ae81ff">40</span>     $display(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%d:</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%d /%d =%d (r =%d) (DBZ=%b)&#34;</span>, $time, x, y, q, r, dbz);

                x <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span><span style="color:#ae81ff">&#39;b1000</span>;  <span style="color:#75715e">// 8
</span><span style="color:#75715e"></span>                y <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span><span style="color:#ae81ff">&#39;b1001</span>;  <span style="color:#75715e">// 9
</span><span style="color:#75715e"></span>                start <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
        #<span style="color:#ae81ff">10</span>     start <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
        #<span style="color:#ae81ff">40</span>     $display(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%d:</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%d /%d =%d (r =%d) (DBZ=%b)&#34;</span>, $time, x, y, q, r, dbz);
                $finish;
    <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">endmodule</span>
</code></pre></div><p><em>NB. I have tested with a wide range of values, but only show a few here to keep the example managable.</em></p>
<p>The output looks like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"> 7 / 2 = 3 (r = 1) (DBZ=0)
 0 / 2 = 0 (r = 0) (DBZ=0)
 2 / 0 = 0 (r = 0) (DBZ=1)
 3 / 2 = 1 (r = 1) (DBZ=0)
15 / 5 = 3 (r = 0) (DBZ=0)
13 / 7 = 1 (r = 6) (DBZ=0)
 8 / 9 = 0 (r = 8) (DBZ=0)
</code></pre></div><h2 id="fixed-point-support">Fixed-Point Support</h2>
<p>In a previous recipe, we looked at <a href="/posts/fixed-point-numbers-in-verilog/">Fixed Point Numbers in Verilog</a>, but didn&rsquo;t cover division, so let&rsquo;s do that now. We have two changes to make:</p>
<ol>
<li>Increasing the number of iterations</li>
<li>Handling overflow</li>
</ol>
<p><em>NB. We don&rsquo;t currently support signed values with this division algorithm.</em></p>
<p>To account for the fractional part of the number, we need to increase the number of iterations by the number of fractional bits.</p>
<p><strong>More explanation to follow&hellip;</strong></p>
<p>With these changes, the module looks like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog"><span style="color:#75715e">// Project F: Division (Fixed-Point)
</span><span style="color:#75715e">// (C)2021 Will Green, Open source hardware released under the MIT License
</span><span style="color:#75715e">// Learn more at https://projectf.io
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">`default_nettype</span> none
<span style="color:#66d9ef">`timescale</span> <span style="color:#ae81ff">1</span>ns <span style="color:#f92672">/</span> <span style="color:#ae81ff">1</span>ps

<span style="color:#66d9ef">module</span> div #(
    <span style="color:#66d9ef">parameter</span> WIDTH<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>,  <span style="color:#75715e">// width of numbers in bits
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">parameter</span> FBITS<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>   <span style="color:#75715e">// fractional bits (for fixed point)
</span><span style="color:#75715e"></span>    ) (
    <span style="color:#66d9ef">input</span> <span style="color:#66d9ef">wire</span> <span style="color:#66d9ef">logic</span> clk,
    <span style="color:#66d9ef">input</span> <span style="color:#66d9ef">wire</span> <span style="color:#66d9ef">logic</span> start,          <span style="color:#75715e">// start signal
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">output</span>     <span style="color:#66d9ef">logic</span> busy,           <span style="color:#75715e">// calculation in progress
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">output</span>     <span style="color:#66d9ef">logic</span> valid,          <span style="color:#75715e">// quotient and remainder are valid
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">output</span>     <span style="color:#66d9ef">logic</span> dbz,            <span style="color:#75715e">// divide by zero flag
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">output</span>     <span style="color:#66d9ef">logic</span> ovf,            <span style="color:#75715e">// overflow flag (fixed-point)
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">input</span> <span style="color:#66d9ef">wire</span> <span style="color:#66d9ef">logic</span> [WIDTH<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] x,  <span style="color:#75715e">// dividend
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">input</span> <span style="color:#66d9ef">wire</span> <span style="color:#66d9ef">logic</span> [WIDTH<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] y,  <span style="color:#75715e">// divisor
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">output</span>     <span style="color:#66d9ef">logic</span> [WIDTH<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] q,  <span style="color:#75715e">// quotient
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">output</span>     <span style="color:#66d9ef">logic</span> [WIDTH<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] r   <span style="color:#75715e">// remainder
</span><span style="color:#75715e"></span>    );

    <span style="color:#75715e">// avoid negative vector width when fractional bits are not used
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">localparam</span> FBITSW <span style="color:#f92672">=</span> (FBITS) <span style="color:#f92672">?</span> FBITS <span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>;

    <span style="color:#66d9ef">logic</span> [WIDTH<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] y1;           <span style="color:#75715e">// copy of divisor
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> [WIDTH<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] q1, q1_next;  <span style="color:#75715e">// intermediate quotient
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> [WIDTH:<span style="color:#ae81ff">0</span>] ac, ac_next;    <span style="color:#75715e">// accumulator (1 bit wider)
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">localparam</span> ITER <span style="color:#f92672">=</span> WIDTH<span style="color:#f92672">+</span>FBITS;  <span style="color:#75715e">// iterations are dividend width + fractional bits
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> [$clog2(ITER)<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] i;     <span style="color:#75715e">// iteration counter
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">always_comb</span> <span style="color:#66d9ef">begin</span>
        <span style="color:#66d9ef">if</span> (ac <span style="color:#f92672">&gt;=</span> {<span style="color:#ae81ff">1</span><span style="color:#ae81ff">&#39;b0</span>,y1}) <span style="color:#66d9ef">begin</span>
            ac_next <span style="color:#f92672">=</span> ac <span style="color:#f92672">-</span> y1;
            {ac_next, q1_next} <span style="color:#f92672">=</span> {ac_next[WIDTH<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>], q1, <span style="color:#ae81ff">1</span><span style="color:#ae81ff">&#39;b1</span>};
        <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">begin</span>
            {ac_next, q1_next} <span style="color:#f92672">=</span> {ac, q1} <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>;
        <span style="color:#66d9ef">end</span>
    <span style="color:#66d9ef">end</span>

    <span style="color:#66d9ef">always_ff</span> @(<span style="color:#66d9ef">posedge</span> clk) <span style="color:#66d9ef">begin</span>
        <span style="color:#66d9ef">if</span> (start) <span style="color:#66d9ef">begin</span>
            valid <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
            ovf <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
            i <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
            <span style="color:#66d9ef">if</span> (y <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">begin</span>  <span style="color:#75715e">// catch divide by zero
</span><span style="color:#75715e"></span>                busy <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
                dbz <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>;
            <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">begin</span>
                busy <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>;
                dbz <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
                y1 <span style="color:#f92672">&lt;=</span> y;
                {ac, q1} <span style="color:#f92672">&lt;=</span> {{WIDTH{<span style="color:#ae81ff">1</span><span style="color:#ae81ff">&#39;b0</span>}}, x, <span style="color:#ae81ff">1</span><span style="color:#ae81ff">&#39;b0</span>};
            <span style="color:#66d9ef">end</span>
        <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (busy) <span style="color:#66d9ef">begin</span>      
            <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">==</span> ITER<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">begin</span>  <span style="color:#75715e">// done
</span><span style="color:#75715e"></span>                busy <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
                valid <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>;
                q <span style="color:#f92672">&lt;=</span> q1_next;
                r <span style="color:#f92672">&lt;=</span> ac_next[WIDTH:<span style="color:#ae81ff">1</span>];  <span style="color:#75715e">// undo final shift
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">==</span> WIDTH<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">&amp;&amp;</span> q1_next[WIDTH<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>WIDTH<span style="color:#f92672">-</span>FBITSW]) <span style="color:#66d9ef">begin</span> <span style="color:#75715e">// overflow?
</span><span style="color:#75715e"></span>                busy <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
                ovf <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>;
                q <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
                r <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>;
            <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">begin</span>  <span style="color:#75715e">// next iteration
</span><span style="color:#75715e"></span>                i <span style="color:#f92672">&lt;=</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
                ac <span style="color:#f92672">&lt;=</span> ac_next;
                q1 <span style="color:#f92672">&lt;=</span> q1_next;
            <span style="color:#66d9ef">end</span>
        <span style="color:#66d9ef">end</span>
    <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">endmodule</span>
</code></pre></div><p>A new test bench can exercise the module (a sample of tests shown for brevity):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog"><span style="color:#75715e">// Project F: Test Bench for Fixed-Point Division
</span><span style="color:#75715e">// (C)2021 Will Green, Open source hardware released under the MIT License
</span><span style="color:#75715e">// Learn more at https://projectf.io
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">`default_nettype</span> none
<span style="color:#66d9ef">`timescale</span> <span style="color:#ae81ff">1</span>ns <span style="color:#f92672">/</span> <span style="color:#ae81ff">1</span>ps

<span style="color:#66d9ef">module</span> div_tb();

    <span style="color:#66d9ef">parameter</span> CLK_PERIOD <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>;
    <span style="color:#66d9ef">parameter</span> WIDTH <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>;
    <span style="color:#66d9ef">parameter</span> FBITS <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>;
    <span style="color:#66d9ef">parameter</span> SF <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">**-</span><span style="color:#ae81ff">4.0</span>;  <span style="color:#75715e">// Q4.4 scaling factor is 2^-4
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">logic</span> clk;
    <span style="color:#66d9ef">logic</span> start;            <span style="color:#75715e">// start signal
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> busy;             <span style="color:#75715e">// calculation in progress
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> valid;            <span style="color:#75715e">// quotient and remainder are valid
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> dbz;              <span style="color:#75715e">// divide by zero flag
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> ovf;              <span style="color:#75715e">// overflow flag (fixed-point only)
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> [WIDTH<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] x;    <span style="color:#75715e">// dividend
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> [WIDTH<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] y;    <span style="color:#75715e">// divisor
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> [WIDTH<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] q;    <span style="color:#75715e">// quotient
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">logic</span> [WIDTH<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] r;    <span style="color:#75715e">// remainder
</span><span style="color:#75715e"></span>
    div #(.WIDTH(WIDTH), .FBITS(FBITS)) div_inst (.<span style="color:#f92672">*</span>);

    <span style="color:#66d9ef">always</span> #(CLK_PERIOD <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>) clk <span style="color:#f92672">=</span> <span style="color:#f92672">~</span>clk;

    <span style="color:#66d9ef">initial</span> <span style="color:#66d9ef">begin</span>
                clk <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;

        #<span style="color:#ae81ff">100</span>    x <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span><span style="color:#ae81ff">&#39;b0011</span>_0000;  <span style="color:#75715e">// 3.0
</span><span style="color:#75715e"></span>                y <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span><span style="color:#ae81ff">&#39;b0010</span>_0000;  <span style="color:#75715e">// 2.0
</span><span style="color:#75715e"></span>                start <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
        #<span style="color:#ae81ff">10</span>     start <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
        #<span style="color:#ae81ff">120</span>    $display(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%d:</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%f / %f = %b (%f) (r = %b) (DBZ=%b) (OVF=%b)&#34;</span>, 
                    $time, $itor(x)<span style="color:#f92672">*</span>SF, $itor(y)<span style="color:#f92672">*</span>SF, q, $itor(q)<span style="color:#f92672">*</span>SF, r, dbz, ovf);

                x <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span><span style="color:#ae81ff">&#39;b0010</span>_0000;  <span style="color:#75715e">// 2.0
</span><span style="color:#75715e"></span>                y <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span><span style="color:#ae81ff">&#39;b0001</span>_0110;  <span style="color:#75715e">// 1.375 (the largest number that&#39;s ≤√2 in Q4.4)
</span><span style="color:#75715e"></span>                start <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
        #<span style="color:#ae81ff">10</span>     start <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
        #<span style="color:#ae81ff">120</span>    $display(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%d:</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%f / %f = %b (%f) (r = %b) (DBZ=%b) (OVF=%b)&#34;</span>, 
                    $time, $itor(x)<span style="color:#f92672">*</span>SF, $itor(y)<span style="color:#f92672">*</span>SF, q, $itor(q)<span style="color:#f92672">*</span>SF, r, dbz, ovf);

                x <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span><span style="color:#ae81ff">&#39;b0010</span>_0000;  <span style="color:#75715e">// 2.0
</span><span style="color:#75715e"></span>                y <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span><span style="color:#ae81ff">&#39;b0000</span>_0000;  <span style="color:#75715e">// 0.0
</span><span style="color:#75715e"></span>                start <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
        #<span style="color:#ae81ff">10</span>     start <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
        #<span style="color:#ae81ff">120</span>    $display(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%d:</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%f / %f = %b (%f) (r = %b) (DBZ=%b) (OVF=%b)&#34;</span>, 
                    $time, $itor(x)<span style="color:#f92672">*</span>SF, $itor(y)<span style="color:#f92672">*</span>SF, q, $itor(q)<span style="color:#f92672">*</span>SF, r, dbz, ovf);

                x <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span><span style="color:#ae81ff">&#39;b0000</span>_0000;  <span style="color:#75715e">// 0.0
</span><span style="color:#75715e"></span>                y <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span><span style="color:#ae81ff">&#39;b0010</span>_0000;  <span style="color:#75715e">// 2.0
</span><span style="color:#75715e"></span>                start <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
        #<span style="color:#ae81ff">10</span>     start <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
        #<span style="color:#ae81ff">120</span>    $display(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%d:</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%f / %f = %b (%f) (r = %b) (DBZ=%b) (OVF=%b)&#34;</span>, 
                    $time, $itor(x)<span style="color:#f92672">*</span>SF, $itor(y)<span style="color:#f92672">*</span>SF, q, $itor(q)<span style="color:#f92672">*</span>SF, r, dbz, ovf);

                x <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span><span style="color:#ae81ff">&#39;b0000</span>_0010;  <span style="color:#75715e">// 0.125
</span><span style="color:#75715e"></span>                y <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span><span style="color:#ae81ff">&#39;b0010</span>_0000;  <span style="color:#75715e">// 2.0
</span><span style="color:#75715e"></span>                start <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
        #<span style="color:#ae81ff">10</span>     start <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
        #<span style="color:#ae81ff">150</span>    $display(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%d:</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%f / %f = %b (%f) (r = %b) (DBZ=%b) (OVF=%b)&#34;</span>, 
                    $time, $itor(x)<span style="color:#f92672">*</span>SF, $itor(y)<span style="color:#f92672">*</span>SF, q, $itor(q)<span style="color:#f92672">*</span>SF, r, dbz, ovf);

                x <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span><span style="color:#ae81ff">&#39;b1000</span>_0000;  <span style="color:#75715e">// 8.0
</span><span style="color:#75715e"></span>                y <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span><span style="color:#ae81ff">&#39;b0000</span>_0100;  <span style="color:#75715e">// 0.25
</span><span style="color:#75715e"></span>                start <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
        #<span style="color:#ae81ff">10</span>     start <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
        #<span style="color:#ae81ff">120</span>    $display(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%d:</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%f / %f = %b (%f) (r = %b) (DBZ=%b) (OVF=%b)&#34;</span>, 
                    $time, $itor(x)<span style="color:#f92672">*</span>SF, $itor(y)<span style="color:#f92672">*</span>SF, q, $itor(q)<span style="color:#f92672">*</span>SF, r, dbz, ovf);

                x <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span><span style="color:#ae81ff">&#39;b1111</span>_1110;  <span style="color:#75715e">// 15.875
</span><span style="color:#75715e"></span>                y <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span><span style="color:#ae81ff">&#39;b0010</span>_0000;  <span style="color:#75715e">// 2.0
</span><span style="color:#75715e"></span>                start <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
        #<span style="color:#ae81ff">10</span>     start <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
        #<span style="color:#ae81ff">120</span>    $display(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%d:</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%f / %f = %b (%f) (r = %b) (DBZ=%b) (OVF=%b)&#34;</span>, 
                    $time, $itor(x)<span style="color:#f92672">*</span>SF, $itor(y)<span style="color:#f92672">*</span>SF, q, $itor(q)<span style="color:#f92672">*</span>SF, r, dbz, ovf);

                x <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span><span style="color:#ae81ff">&#39;b1000</span>_0000;  <span style="color:#75715e">// 8.0
</span><span style="color:#75715e"></span>                y <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span><span style="color:#ae81ff">&#39;b1001</span>_0000;  <span style="color:#75715e">// 9.0
</span><span style="color:#75715e"></span>                start <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
        #<span style="color:#ae81ff">10</span>     start <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
        #<span style="color:#ae81ff">120</span>    $display(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%d:</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%f / %f = %b (%f) (r = %b) (DBZ=%b) (OVF=%b)&#34;</span>, 
                    $time, $itor(x)<span style="color:#f92672">*</span>SF, $itor(y)<span style="color:#f92672">*</span>SF, q, $itor(q)<span style="color:#f92672">*</span>SF, r, dbz, ovf);
                $finish;
    <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">endmodule</span>
</code></pre></div><p>The output looks like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"> 3.000000 /  2.000000 = 00011000  (1.500000) (r = 00000000) (DBZ=0) (OVF=0)
 2.000000 /  1.375000 = 00010111  (1.437500) (r = 00000110) (DBZ=0) (OVF=0)
 2.000000 /  0.000000 = 00000000  (0.000000) (r = 00000000) (DBZ=1) (OVF=0)
 0.000000 /  2.000000 = 00000000  (0.000000) (r = 00000000) (DBZ=0) (OVF=0)
 0.125000 /  2.000000 = 00000001  (0.062500) (r = 00000000) (DBZ=0) (OVF=0)
 8.000000 /  0.250000 = 00000000  (0.000000) (r = 00000000) (DBZ=0) (OVF=1)
15.875000 /  2.000000 = 01111111  (7.937500) (r = 00000000) (DBZ=0) (OVF=0)
 8.000000 /  9.000000 = 00001110  (0.875000) (r = 00100000) (DBZ=0) (OVF=0)
</code></pre></div><p>Try experimenting with a wider range of test values and different fractional widths.</p>
<h2 id="signed-numbers">Signed Numbers</h2>
<p>I plan to add support for signed numbers during 2021. Follow <a href="https://twitter.com/WillFlux">@WillFlux</a> for updates.</p>

      
      <div class="related">

<h3>Similar articles:</h3>
<ul>
	
	<li><a href="/posts/fixed-point-numbers-in-verilog/">Fixed Point Numbers in Verilog</a></li>
	
	<li><a href="/posts/video-timings-vga-720p-1080p/">Video Timings: VGA, SVGA, 720p, 1080p</a></li>
	
	<li><a href="/posts/initialize-memory-in-verilog/">Initialize Memory in Verilog</a></li>
	
</ul>
</div>
      
    </div>
    
  </div>
</section>

    <script src="/js/copycode.js"></script>



<section class="section">
  <div class="container has-text-centered">
    <p>©2020 Will Green, Project F</p>
    
  </div>
</section>


<script src="https://narwhal.projectf.io/script.js" site="EVCGKVDN" defer></script>
</body>
</html>

